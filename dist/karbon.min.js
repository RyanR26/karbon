var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},toConsumableArray=function(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)},subscription=function(){var e={};return{add:function(n,t,o,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];i=i||[],e[o]=function(e){r.apply(null,[].concat(toConsumableArray(i),[e]))},n.addEventListener(t,e[o])},remove:function(n,t,o){n.removeEventListener(t,e[o]),e[o]=void 0},getCache:function(){return e}}}(),isUndefined=function(e){return void 0===e},isDefined=function(e){return void 0!==e},isNull=function(e){return null===e},isNotNull=function(e){return null!==e},isNullorUndef=function(e){return isUndefined(e)||isNull(e)},isNotNullandIsDef=function(e){return null!==e&&void 0!==e},isFalse=function(e){return!1===e},isNotFalse=function(e){return!1!==e},isEmpty=function(e){return""===e},isNotEmpty=function(e){return""!==e},isFunction=function(e){return"function"==typeof e},isObject=function(e){return"object"===(void 0===e?"undefined":_typeof(e))},isArray=Array.isArray,isNumber=function(e){return"number"==typeof e},isString=function(e){return"string"==typeof e},randomStringId=function(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(2,10)},clearObject=function(e){for(var n in e)delete e[n]},arraysAreEqual=function(e,n){var t=e.length;if(t!==n.length)return!1;for(var o=0;o<t;o++)if(e[o]!==n[o])return!1;return!0},keyList=Object.keys,hasProp=Object.prototype.hasOwnProperty,objsAreEqual=function e(n,t){if(n===t)return!0;if(n&&t&&"object"==(void 0===n?"undefined":_typeof(n))&&"object"==(void 0===t?"undefined":_typeof(t))){var o=isArray(n),r=isArray(t),i=void 0,d=void 0,s=void 0;if(o&&r){if((d=n.length)!=t.length)return!1;for(i=d;0!=i--;)if(!e(n[i],t[i]))return!1;return!0}var l=keyList(n);if((d=l.length)!==keyList(t).length)return!1;for(i=d;0!=i--;)if(!hasProp.call(t,l[i]))return!1;for(i=d;0!=i--;)if(!e(n[s=l[i]],t[s]))return!1;return!0}return n!=n&&t!=t},virtualDom=function(){var e=!1,n=!0,t=!1;return{isInitialized:function(){return e},setInitialized:function(n){return e=n},requiresSync:function(){return n},setSync:function(e){return n=e},constrainDomUpdates:function(e){return t=e},getDomUpdatesLimit:function(){return t}}}(),createRunTime=function(e,n){var t,o,r,i,d,s,l=void 0,a=e.appFx[n],c=0,p={},u={},v=void 0,f=function(e){l=e},N=function(){return l},h=(t=null,o=null,r=void 0,i=void 0,d=function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];t=null,c++;var d=(r||randomStringId())+"_"+c,l=Object.assign({},i);return i=void 0,r=void 0,window.setTimeout(function(){m(d,n,l)},0),{done:s(d)}},s=function(e){return function(n){isNull(t)?u[e]=n:(delete p[e],n(t,o))}},{stamp:function(e){return r=e.id,i=e.cache,{msgs:d}},messages:d,setCallbackData:function(e,n){t=e,o=n}}),m=function(e,n,t){p[e]=[];for(var o=1;o<n.length;o++)p[e][o-1]=n[o];g(e,n[0],v,t)},y=function(e,n){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments[3];if(isDefined(n))if(p[n].length>0)g(n,p[n].shift(),e,o);else if(delete p[n],isFunction(u[n])){var r=Object.assign({},u);delete u[n],r[n](e,t)}else h.setCallbackData(e,t)},g=function(e,n,t,o){var r=isFunction(n)?isDefined(t)?n("undefined"===t?void 0:t,N(),o):n(N(),o):n;if(isNull(r))y(null,e,v,o);else if(isUndefined(r))y("undefined",e,v,o);else{var i=r[1],d=r[2]||{};switch(r[0]){case"state":isDefined(d.syncNodes)?virtualDom.setSync(!1):virtualDom.setSync(!0),isDefined(d.maxDomUpdates)?virtualDom.constrainDomUpdates(d.maxDomUpdates):virtualDom.constrainDomUpdates(!1),k(i,e,!!d.preventRender,o);break;case"effect":var s=i.cache,l=i.name||i.def,c=isFunction(l)?l:isDefined(a[l])?a[l]:function(){return console.warn("no effect '"+l+"' registered")},f=isArray(i.args)?c.apply(void 0,toConsumableArray(i.args)):c(i.args);f instanceof Promise?Promise.resolve(f).then(function(n){isDefined(s)&&(o[s]=n),y(n,e,v,o)}).catch(function(n){isDefined(s)&&(o[s]=n),y({error:!0,errorMsg:n},e,v,o)}):"_break_"===f?p[e]=[]:(isDefined(s)&&(o[s]=f),y(f,e,v,o));break;case"pipe":var h=i,m=h[0],g=null;if(h.length<2)g=m;else for(var b=1;b<h.length;b++)g=1===b?h[b](m):h[b](g);y(g,e,v,o);break;case"control":i.if||i.continue||isNumber(i.continue)?(!i.if&&isNumber(i.continue)&&(p[e].length=i.continue),y(i.if?i.isTrue:i.isFalse,e,v,o)):(p[e]=[],i.break?delete u[e]:y(i.isFalse,e,!1,o));break;case"cancel":var A=function(e){var n=!1;for(var t in p)console.log(t,e),0===t.indexOf(e)&&(n=!0,p[t]=[],delete u[t]);if(!n)for(var o in u)0===o.indexOf(e)&&delete u[o]},C=i.id;if(isDefined(C)){if(isArray(C))for(var D=0;D<C.length;D++)A(C);else A(C);y(void 0,e)}}}},b=function e(n,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"default",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(isUndefined(t))f(o);else if(2==t.length){if("default"===r)return e(n[t[0]],t.slice(1),o,r,i,d);var s=n[t[0]];if(isNullorUndef(s))throw new Error('Karbon - cannot modify undefined array "'+t[0]+'".');if("splice"===r){var l=t[1];if(i>1){var a=[l,d];if(isArray(o))for(var c=0;c<o.length;c++)a[a.length]=o[c];else for(var p=0;p<i;p++)a[a.length]=o;s.splice.apply(s,a)}else if(isNotNull(o))s.splice(l,d,o);else{if(isNullorUndef(s[l]))throw new Error('Karbon - cannot remove. Array "'+t[0]+'" does not contain item at position "'+l+'".');s.splice(l,d)}}else if("delete"===r){var u=t[1];if(isNullorUndef(s[u]))throw new Error('Karbon - cannot delete undefined obj key "'+u+"\". Check that it wasn't removed in a previous action.");delete s[u]}}else{if(1!=t.length)return 0==t.length?n:e(n[t[0]],t.slice(1),o,r,i,d);var v=t[0];if(!isArray(v))return n[v]=o;for(var N=0;N<v.length;N++)isArray(o)?n[v[N]]=o[N]:n[v[N]]=o}},k=function(t,o,r,i){var d=isArray(t)?[]:isDefined(t.path)?t.path[0]:void 0;if(isArray(t))for(var s=0;s<t.length;s++){var a=t[s];b(l,a.path,a.value,a.action,a.add,a.remove),d[s]=a.path[0]}else b(l,t.path,t.value,t.action,t.add,t.remove);e.runHandleSubs(n),r?y(void 0,o,v,i):e.reRender(d,o,n,i)};return{setState:f,getState:N,exeQueuedMsgs:y,stamp:h.stamp,messages:h.messages}},voidedElements={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,animate:!0,animateTransform:!0,circle:!0,"color-profile":!0,ellipse:!0,feBlend:!0,feColorMatrix:!0,feComposite:!0,feConvolveMatrix:!0,feDisplacementMap:!0,feDistantLight:!0,feFlood:!0,feGaussianBlur:!0,feImage:!0,feMergeNode:!0,feMorphology:!0,feOffset:!0,fePointLight:!0,feSpotLight:!0,feTile:!0,feTurbulence:!0,"font-face-name":!0,image:!0,line:!0,mpath:!0,path:!0,polygon:!0,polyline:!0,set:!0,stop:!0,use:!0,view:!0,rect:!0},elProps=void 0,createVNode=function(e,n,t,o){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments[5],d=arguments[6],s=arguments[7],l=arguments[8],a={};elProps=Object.keys(t);for(var c=0;c<elProps.length;c++){var p=elProps[c],u=t[p];a[p]=isNull(u)?"":"innerHTML"!==p?u:'<span data="untracked-nodes">'+u+"</span>"}return{type:e,lang:l?"xml":"html",props:a,level:o,key:r,staticChildren:i,keyedAction:null,keyedChildren:null,parentComponent:d,parentComponentIndex:n,subscribesTo:s,dom:null}},actionsCache={},nodeBuilder=function(e,n){var t=[],o=[],r=[],i=[],d={},s=void 0,l=void 0,a=!1,c=void 0,p=void 0,u=void 0,v=1,f=!1,N=function(e){v--,"svg"!==e&&"/svg"!==e||(f=!1)},h=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{key:!1,staticChildren:!1};"svg"===e&&(f=!0),l=s.key,a=!1!==l,u=createVNode(e,r[r.length-1],n,v,l,s.staticChildren,o[o.length-1],i[i.length-1],f),t[t.length]=u,isDefined(p)&&v>c?p.keyedChildren[p.keyedChildren.length]=u:isDefined(p)&&v===c&&(p=void 0,c=void 0),a&&(c=v,p=u,u.keyedChildren=[],isUndefined(d[v])&&(d[v]={}),d[v][l]=u),voidedElements[e]||v++},m=function t(d){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};isArray(d)&&(s=d[1]||{},d=d[0]);var l=Object.keys(d)[0],a=d[l],c=isUndefined(s.index)?0:s.index;o[o.length]=l,r[r.length]=c;var p=void 0,u=s.actions;if(isDefined(u)){p={},u=isArray(u)?u:[u];for(var v=0;v<u.length;v++){var f=u[v],m=Object.keys(f)[0];isDefined(actionsCache[m])?p[m]=actionsCache[m]:(p[m]=f[m]({stamp:e.stamp,msgs:e.messages}),actionsCache[m]=p[m])}}i[i.length]=isUndefined(s.subscribe)||"all"===s.subscribe?Object.keys(e.getState()):s.subscribe;var y=isDefined(s.mergeStateToProps)?s.mergeStateToProps(e.getState()):void 0;a(isDefined(y)?Object.assign({},s.props,y):s.props,isDefined(p)||isDefined(n)?Object.assign({},p,n):void 0,c)(h,N,t),i.length=i.length-1,o.length=o.length-1,r.length=r.length-1};return{renderRootComponent:function(e,n){m(e,n)},component:m,getKeyedNodes:function(){return d},getKeyedNodesPrev:function(){return s},setKeyedNodesPrev:function(){s=Object.assign({},d),clearObject(d)},getVDomNodesArray:function(){return t},resetVDomNodesArray:function(){t.length=0}}},nodeProps=void 0,elProps$1=void 0,el=void 0,isSVG=!1,createDomElement=function(e){nodeProps=e.props,elProps$1=Object.keys(nodeProps),"xml"!==e.lang?(isSVG=!1,el=document.createElement(e.type)):(isSVG=!0,el=document.createElementNS("http://www.w3.org/2000/svg",e.type));for(var n=function(e,n){var t=elProps$1[e],o=nodeProps[t];if(isObject(o))if(isDefined(o.length))if("o"===t[0]&&"n"===t[1])el[t]=function(e){return o[0].apply(null,[].concat(toConsumableArray(o.slice(1)),[e]))};else if("class"===t){var r,i=o.filter(Boolean);if(i.length>0)(r=el.classList).add.apply(r,toConsumableArray(i))}else for(var d=0;d<o.length;d++){var s=o[d].split("=");el.setAttribute("data-"+s[0],s[1]||"")}else for(var l=Object.keys(o),a=0;a<l.length;a++){var c=l[a];el[t][c]=o[c]}else"text"===t?el.textContent=o:"class"===t?isNotEmpty(o)&&(el.className=o):isDefined(el[t])&&!isSVG?el[t]=o:el.setAttribute(t,o)},t=0,o=elProps$1.length;t<o;t++)n(t);return el},props=[],values=[],newPropsKeys=void 0,prevPropsKeys=void 0,renderObj={should:null,action:null,keyedAction:null,untrackedHtmlNodes:null,props:null,values:null},updateRenderObj=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;renderObj.should=e,renderObj.action=n,renderObj.keyedAction=t,renderObj.untrackedHtmlNodes=untrackedHtmlNodes,renderObj.props=o,renderObj.values=r},prevProps=void 0,newProps=void 0,notChanged=void 0,untrackedHtmlNodes=void 0,handleKeyedNode=void 0,overrideDefaultAction=void 0,forceReplace=void 0,statefulElements={radio:!0},shouldRenderNode=function(e,n,t,o,r,i,d){if(prevProps=e.props,newProps=n.props,notChanged=!0,untrackedHtmlNodes=!1,handleKeyedNode=!1,forceReplace=!1,props.length=0,values.length=0,notChanged=!(n.type!==e.type||isNull(prevProps)||isNull(newProps)||isNotNull(n.keyedAction))&&objsAreEqual(prevProps,newProps),overrideDefaultAction=(o||r)&&i>d)return"removed"!==t.action&&(updateRenderObj(!0,"newNode"),renderObj);if(notChanged)return!1;if(isNotNull(prevProps)&&isNotNull(newProps)){if(isDefined(newProps.innerHTML)&&(untrackedHtmlNodes=!0),statefulElements[prevProps.type]&&prevProps.type===newProps.type&&(forceReplace=!0),!1===n.key&&!1===e.key||!isNotNull(n.keyedAction)||(handleKeyedNode=!0),(n.type!==e.type||untrackedHtmlNodes||forceReplace)&&!handleKeyedNode)return updateRenderObj(!0,"replaceNode"),renderObj;newPropsKeys=Object.keys(newProps),prevPropsKeys=Object.keys(prevProps);for(var s=void 0,l=void 0,a=0;a<newPropsKeys.length;a++)s=newPropsKeys[a],l=newProps[s],isDefined(prevProps[s])?isArray(l)?arraysAreEqual(l,prevProps[s])||(props[props.length]=s,values[values.length]=l):isObject(l)?objsAreEqual(l,prevProps[s])||(props[props.length]=s,values[values.length]=l):l!==prevProps[s]&&(props[props.length]=s,values[values.length]=l):(props[props.length]=s,values[values.length]=l);for(var c=0;c<prevPropsKeys.length;c++){var p=prevPropsKeys[c];-1===newPropsKeys.indexOf(p)&&("innerHTML"!==p?(props[props.length]=p,values[values.length]="class"===p||"dataAttrs"===p?[]:""):(props.unshift(p),values.unshift("")))}return handleKeyedNode?(updateRenderObj(!0,"handleKeyedUpdate",n.keyedAction,props,values),renderObj):(updateRenderObj(!0,"updateNode",void 0,props,values),renderObj)}return isNull(prevProps)&&isNotNull(newProps)?(isDefined(newProps.innerHTML)&&(untrackedHtmlNodes=!0),"insertNew"===n.keyedAction?updateRenderObj(!0,"handleKeyedUpdate",n.keyedAction):updateRenderObj(!0,"newNode",e.keyedAction),renderObj):!(!isNotNull(prevProps)||!isNull(newProps))&&("recycled"===n.keyedAction?n.keyedAction:"recyclable"===n.keyedAction?(updateRenderObj(!0,n.keyedAction),renderObj):(updateRenderObj(!0,"removeNode"),renderObj))},firstChildNode=void 0,updateChangedNode=function(e,n,t){switch(e){case"class":if(t.removeAttribute(e),isString(n)&&isNotEmpty(n))t.className=n;else if(isArray(n)&&n.length>0){var o;(o=t.classList).add.apply(o,toConsumableArray(n.filter(Boolean)))}break;case"style":for(var r=Object.keys(n),i="",d=0;d<r.length;d++){var s=r[d];isDefined(n[s])&&(i+=s+":"+n[s]+"; ")}isNotEmpty(i)?t.style.cssText=i:t.removeAttribute(e);break;case"text":t.hasChildNodes()?(firstChildNode=t.firstChild,isDefined(firstChildNode.data)?firstChildNode.data=n:t.insertBefore(document.createTextNode(n),firstChildNode)):t.textContent=n;break;case"dataAttrs":for(var l=0;l<t.attributes.length;l++)/^data-/i.test(t.attributes[l].name)&&(t.removeAttribute(t.attributes[l].name),l--);for(var a=0;a<n.length;a++){var c=n[a].split("=");t.setAttribute("data-"+c[0],c[1]||"")}break;default:"o"===e[0]&&"n"===e[1]?t[e]=function(e){return n[0].apply(null,[].concat(toConsumableArray(n.slice(1)),[e]))}:isUndefined(t[e])||t instanceof SVGElement?t.setAttribute(e,n):isEmpty(n)?(t[e]=!1,t.removeAttribute(e)):t[e]=n}},emptyVNodeStatic={type:null,lang:null,props:null,level:void 0,key:!1,keyedAction:null,keyedChildren:null,staticChildren:!1,parentComponent:null,parentComponentIndex:null,subscribesTo:null,dom:null},recycledVNodeStatic=Object.assign({},emptyVNodeStatic,{keyedAction:"recycled"}),recyclableVNodeStatic=Object.assign({},emptyVNodeStatic,{keyedAction:"recyclable"}),syncVNodes=function(e,n,t,o){for(var r=void 0,i=void 0,d=!1,s=function(s){if(r=n[s],i=e[s],d=!1,isUndefined(r)?n[s]=emptyVNodeStatic:r.level>i.level?e.splice(s,0,emptyVNodeStatic):r.level<i.level&&n.splice(s,0,emptyVNodeStatic),s===e.length-1){var l=n.length-e.length;if(l>0)for(var a=1;a<=l;a++)e[e.length]=emptyVNodeStatic,d=!0}r=n[s],i=e[s];var c=o[i.level||r.level];if(isDefined(c)){var p=void 0,u=void 0,v=void 0;if(isNotFalse(i.key)&&r.key!==i.key){p=isDefined(c[r.key]),u=!isUndefined(t[i.level])&&isDefined(t[i.level][r.key]),i.level<=v&&(v=void 0),v=isDefined(v)?v:i.level;var f=c[i.key];if(isDefined(f)){var N=function(){if(f.keyedChildren.length>0){for(var e=0;isDefined(n[s+e+1])&&n[s+e+1].level>v;)e++;n.splice.apply(n,[s+1,e].concat(toConsumableArray(f.keyedChildren)))}};isNull(r.props)||isNotFalse(r.key)&&!p?(n[s]=f,i.keyedAction="insertOld",N()):isFalse(r.key)||!u?(e.splice(s,0,emptyVNodeStatic),i=e[s]):(n[s]=f,i.keyedAction="swap",N()),delete c[i.key]}else isNull(r.props)?n[s]=emptyVNodeStatic:n.splice(s,0,emptyVNodeStatic),i.keyedAction="insertNew"}else if(isNotFalse(i.key)&&r.key===i.key)i.keyedAction="updateAttrs";else if(isNotFalse(r.key)&&r.key!==i.key){p=isDefined(c[r.key]),u=!isUndefined(t[r.level])&&isDefined(t[r.level][r.key]);var h=function(){if(r.keyedChildren.length>0){for(var e=0;isDefined(n[s+e+1])&&n[s+e+1].level>r.level;)e++;n.splice(s+1,e)}};isNotNull(i.props)?p&&u?(n.splice(s,0,emptyVNodeStatic),i.keyedAction="insertNew",h()):!p&&u?(e.splice(s,0,recycledVNodeStatic),h()):u||(r.key=!1):u?(e[s]=recyclableVNodeStatic,h()):r.key=!1}}if(d&&e.length===n.length)return"break"},l=0;l<e.length;l++){if("break"===s(l))break}return{domNodes:e,domNodesPrev:n}},getNodeRelations=function(e,n,t,o,r,i,d,s,l,a){var c=void 0,p="child",u=void 0,v=null,f=null,N=null,h=isUndefined(o)?-1:isNotNull(o.props)?o.level:d.level,m=isUndefined(r)?void 0:isNotNull(r.props)?r.level:s.level;return e>0&&(h<l?(c="parent",p="child"):h>l?(c="child",p="parent"):(c="child",p="sibling"),isDefined(d)&&isNull(o.props)&&isNotNull(d.props)&&(N="removed")),e<n.length-a-1&&(u=m<l?"parent":m>l?"child":"sibling",isNull(r.props)&&(f="removed"),isDefined(s)&&isNull(s.props)&&(f="add")),isNull(t.props)&&(v="removed"),isDefined(i)&&isNull(i.props)&&(v="add"),{previous:c,current:p,next:u,action:v,actionNext:f,actionPrev:N,nextNodeLevel:m}},nodeReplacedFlag=void 0,nodeRemovedFlag=void 0,handleUntrackedHtmlNodesFlag=void 0,forceUpdateStartLevel=void 0,keyedNodeRecycleBin={},$_parentNodeStack=[],$_parentNode=void 0,$_currentNode=void 0,$_prevParentCache=void 0,node=void 0,prevNode=void 0,currentLevel=void 0,nR=void 0,nodeIsListeningToStateKey=void 0,renderNode=void 0,prevLevel=void 0,nodesToSkip=void 0,domOpsCount=void 0,domOpsComplete=void 0,syncedVNodes=void 0,subscribesTo=void 0,childNodeIndexes=[],getDomIndex=function(e){return childNodeIndexes[e]},updateChildNodeFauxDomIndexes=function(e,n){switch(e.current){case"parent":childNodeIndexes[n]++;break;case"child":childNodeIndexes[n]=0;break;case"sibling":childNodeIndexes[n]++}},replaceNode=function(e,n,t){isDefined(t)&&isNotNull(t)?e.replaceChild(n,t):e.appendChild(n)},swapElements=function(e,n,t){var o=t.nextSibling;o===n?e.insertBefore(n,t):e.insertBefore(t,n),isDefined(n)&&e.insertBefore(n,o)},updateProperties=function(e,n,t){for(var o=0;o<e.length;o++)updateChangedNode(e[o],n[o],t)},patch=function(){if(renderNode=shouldRenderNode(prevNode,node,nR,nodeReplacedFlag,nodeRemovedFlag,currentLevel,forceUpdateStartLevel),currentLevel<=forceUpdateStartLevel&&(nodeReplacedFlag=!1,nodeRemovedFlag=!1),renderNode.should){switch(handleUntrackedHtmlNodesFlag&&childNodeIndexes[currentLevel]++,renderNode.action){case"updateNode":$_currentNode=prevNode.dom,node.dom=$_currentNode,updateProperties(renderNode.props,renderNode.values,$_currentNode),domOpsCount++;break;case"newNode":$_currentNode=createDomElement(node),node.dom=$_currentNode,$_parentNode.appendChild($_currentNode),domOpsCount++;break;case"replaceNode":$_currentNode=createDomElement(node),node.dom=$_currentNode,replaceNode($_parentNode,$_currentNode,prevNode.dom,currentLevel),nodeReplacedFlag=!0,forceUpdateStartLevel=currentLevel,domOpsCount++;break;case"removeNode":var e=prevNode.dom;isNotNullandIsDef(e)&&($_parentNode.removeChild(e),e=null,childNodeIndexes[currentLevel]--,nodeRemovedFlag=!0,forceUpdateStartLevel=currentLevel,domOpsCount++);break;case"recyclable":isUndefined(keyedNodeRecycleBin[prevNode.key])?keyedNodeRecycleBin[prevNode.key]=!0:childNodeIndexes[currentLevel]--;break;case"handleKeyedUpdate":var n=$_parentNode.children[getDomIndex(currentLevel)],t=prevNode.dom,o=renderNode.keyedAction;$_currentNode=t,"insertNew"===o?($_currentNode=createDomElement(node),$_parentNode.insertBefore($_currentNode,n),domOpsCount++):"insertOld"===o?($_parentNode.insertBefore(t,n),keyedNodeRecycleBin[node.key]=!0,domOpsCount++,renderNode.props.length>0&&updateProperties(renderNode.props,renderNode.values,$_currentNode)):"swap"===o||isDefined(n)&&!n.isEqualNode(t)?(swapElements($_parentNode,n,t),keyedNodeRecycleBin[node.key]=!0,domOpsCount++,renderNode.props.length>0&&updateProperties(renderNode.props,renderNode.values,$_currentNode)):"updateAttrs"===o&&renderNode.props.length>0&&(updateProperties(renderNode.props,renderNode.values,$_currentNode),domOpsCount++),node.dom=$_currentNode}handleUntrackedHtmlNodesFlag=!(!renderNode.untrackedHtmlNodes||"child"!==nR.next||"removed"===nR.actionNext)}else node.dom=prevNode.dom,$_currentNode=node.dom,"recycled"===renderNode&&childNodeIndexes[currentLevel]--},createView=function(e,n,t,o,r,i){nodeReplacedFlag=!1,nodeRemovedFlag=!1,handleUntrackedHtmlNodesFlag=!1,forceUpdateStartLevel=null,$_parentNode=void 0,$_currentNode=void 0,$_prevParentCache=void 0,node=void 0,prevNode=void 0,currentLevel=void 0,nR=void 0,nodeIsListeningToStateKey=!1,renderNode=void 0,prevLevel=0,nodesToSkip=0,domOpsCount=0,domOpsComplete=!1,syncedVNodes=void 0,subscribesTo=null,clearObject(keyedNodeRecycleBin),$_parentNodeStack.length=0,childNodeIndexes.length=0,virtualDom.isInitialized()&&virtualDom.requiresSync()&&(n=(syncedVNodes=syncVNodes(n.slice(0),t,r,i)).domNodes,t=syncedVNodes.domNodesPrev);for(var d=0,s=n.length;d<s;d++)if((domOpsComplete||virtualDom.getDomUpdatesLimit()===domOpsCount)&&(domOpsComplete=!0),domOpsComplete)node=n[d],prevNode=t[d],node.dom=prevNode.dom,$_currentNode=node.dom;else{if(nodesToSkip>0&&(d+=nodesToSkip,nodesToSkip=0),node=n[d],prevNode=t[d],isUndefined(node))break;if(virtualDom.isInitialized()&&node.staticChildren&&"insertNew"!==node.keyedAction&&isNotNull(node.keyedAction)&&isDefined(prevNode)&&isNotNull(prevNode.props)&&(nodesToSkip=node.keyedChildren.length),currentLevel=node.level||prevNode.level,nR=getNodeRelations(d,n,node,n[d-1],n[d+nodesToSkip+1],prevNode,t[d-1],t[d+nodesToSkip+1],currentLevel,nodesToSkip),updateChildNodeFauxDomIndexes(nR,currentLevel),0!==d?isDefined($_prevParentCache)&&currentLevel===prevLevel?$_parentNode=$_prevParentCache:($_parentNode=$_parentNodeStack[$_parentNodeStack.length-1],$_prevParentCache=$_parentNode):($_parentNode=e,$_parentNodeStack[0]=$_parentNode),virtualDom.isInitialized()){if(nodeIsListeningToStateKey=!1,subscribesTo=node.subscribesTo||prevNode.subscribesTo,isDefined(o)&&isNotNull(subscribesTo)&&!nodeIsListeningToStateKey){for(var l=0;l<subscribesTo.length;l++)if(o.indexOf(subscribesTo[l])>-1){nodeIsListeningToStateKey=!0;break}}else isNull(subscribesTo)||(nodeIsListeningToStateKey=!0);nodeIsListeningToStateKey?patch():prevNode.parentComponent===node.parentComponent&&isNotNull(node.props)&&isNotNull(prevNode.props)&&!nodeReplacedFlag&&!nodeRemovedFlag&&node.type===prevNode.type&&"insertOld"!==node.keyedAction?(node.dom=prevNode.dom,$_currentNode=node.dom):patch()}else $_currentNode=createDomElement(node),$_parentNode.appendChild($_currentNode),node.dom=$_currentNode;"child"===nR.next&&"removed"!==nR.action?$_parentNodeStack[$_parentNodeStack.length]=$_currentNode:"parent"===nR.next&&$_parentNodeStack.splice(nR.nextNodeLevel,currentLevel-nR.nextNodeLevel),prevLevel=currentLevel}},vdomNodeBuilder=void 0,vDomNodesArrayPrevious=[],renderApp=function(e,n,t,o,r,i,d,s,l,a,c){var p=void 0;s?((vdomNodeBuilder=isDefined(vdomNodeBuilder)?vdomNodeBuilder:{})[a]=nodeBuilder(t,o,i),p=vdomNodeBuilder[a]):(p=vdomNodeBuilder[a],vDomNodesArrayPrevious=p.getVDomNodesArray().slice(0),p.resetVDomNodesArray()),p.setKeyedNodesPrev(),p.renderRootComponent({$$_appRootView:n},{props:t.getState()}),createView(e,p.getVDomNodesArray(),vDomNodesArrayPrevious,i,p.getKeyedNodes(),p.getKeyedNodesPrev(),a),s?(isFunction(r)&&r(o),l&&(virtualDom.setInitialized(!0),virtualDom.setSync(!0))):t.exeQueuedMsgs(void 0,d,void 0,c)},karbon={run:function(){this.runTime={},this.appRootComponent={},this.appRootActions={},this.appContainer={},this.appView={},this.appGlobalActions={},this.appRootSubscribe={},this.appSubs={},this.appFx={},this.appOnInit={};for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];for(var o=0;o<n.length;o++){var r=n[o],i=o,d=o===n.length-1;r.container.innerHTML="",this.appContainer[i]=r.container,this.appFx[i]=r.effects,this.appSubs[i]=r.subscriptions,this.runTime[i]=createRunTime(this,i),this.runTime[i].setState(r.state),this.appView[i]=r.view,this.appGlobalActions[i]=this.initGlobalActions(r.actions,this.runTime[i]),this.appOnInit[i]=r.init,this.runHandleSubs(i),renderApp(this.appContainer[i],this.appView[i],this.runTime[i],this.appGlobalActions[i],this.appOnInit[i],void 0,void 0,!0,d,i)}},initGlobalActions:function(e,n){var t={},o=function(e){var o=Object.keys(e)[0];t[o]=e[o]({stamp:n.stamp,msgs:n.messages})};if(isDefined(e)){if(isArray(e))for(var r=0;r<e.length;r++)o(e[r]);else o(e);return t}},handleSubs:function(e,n){for(var t=0;t<e.length;t++){var o=e[t],r=isArray(o.action)?o.action[0]:o.action;isUndefined(r.name)&&Object.defineProperty(r.prototype,"name",{get:function(){return/function ([^(]*)/.exec(this+"")[1]}});var i=o.id||r.name+"_"+o.name.toString().replace(/\s/g,"");if(isFunction(o.name))o.name({opts:o.options,action:r,actionArgs:isArray(o.action)?o.action.slice(1):[],condition:!!isNullorUndef(o.when)||o.when,subId:i,subCache:subscription.getCache()});else if(isString(o.name)){var d;o.when||isUndefined(o.when)?isDefined(o.name)?isDefined(subscription.getCache()[i])||subscription.add(o.el||window,o.name,i,r,isArray(o.action)?o.action.slice(1):void 0):isArray(o.action)?(d=o.action)[0].apply(d,toConsumableArray(o.action.slice(1))):o.action():o.when||isDefined(o.name)&&isDefined(subscription.getCache()[i])&&subscription.remove(o.el||window,o.name,i)}}},runHandleSubs:function(e){isFunction(this.appSubs[e])&&this.handleSubs(this.appSubs[e](this.runTime[e].getState(),this.appGlobalActions[e]),e)},reRender:function(e,n,t,o){renderApp(this.appContainer[t],this.appView[t],this.runTime[t],this.appGlobalActions[t],void 0,e,n,!1,void 0,t,o)}},run=void 0;document.currentScript&&"noModule"in document.currentScript?run=karbon.run.bind(karbon):(window.karbon={},window.karbon.run=karbon.run.bind(karbon));export{run};
