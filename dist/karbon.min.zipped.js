var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},toConsumableArray=function(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)},subscription=function(){var e={};return{add:function(n,t,i,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];o=o||[],e[i]=function(e){r.apply(null,[].concat(toConsumableArray(o),[e]))},n.addEventListener(t,e[i])},remove:function(n,t,i){n.removeEventListener(t,e[i]),e[i]=void 0},getCache:function(){return e}}}(),isUndefined=function(e){return void 0===e},isDefined=function(e){return void 0!==e},isNull=function(e){return null===e},isNotNull=function(e){return null!==e},isNullorUndef=function(e){return isUndefined(e)||isNull(e)},isNotNullandIsDef=function(e){return null!==e&&void 0!==e},isFalse=function(e){return!1===e},isNotFalse=function(e){return!1!==e},isFunction=function(e){return"function"==typeof e},isObject=function(e){return"object"===(void 0===e?"undefined":_typeof(e))},isArray=function(e){return!isNull(e)&&(isObject(e)&&isDefined(e.length))},isNumber=function(e){return"number"==typeof e},isString=function(e){return"string"==typeof e},randomStringId=function(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(2,10)},arraysAreEqual=function(e,n){var t=e.length;if(t!==n.length)return!1;for(var i=0;i<t;i++)if(e[i]!==n[i])return!1;return!0},isArr=Array.isArray,keyList=Object.keys,hasProp=Object.prototype.hasOwnProperty,objsAreEqual=function e(n,t){if(n===t)return!0;if(n&&t&&"object"==(void 0===n?"undefined":_typeof(n))&&"object"==(void 0===t?"undefined":_typeof(t))){var i=isArr(n),r=isArr(t),o=void 0,s=void 0,l=void 0;if(i&&r){if((s=n.length)!=t.length)return!1;for(o=s;0!=o--;)if(!e(n[o],t[o]))return!1;return!0}var a=keyList(n);if((s=a.length)!==keyList(t).length)return!1;for(o=s;0!=o--;)if(!hasProp.call(t,a[o]))return!1;for(o=s;0!=o--;)if(!e(n[l=a[o]],t[l]))return!1;return!0}return n!=n&&t!=t};window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},window.requestTimeout=function(e,n){if(!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame&&window.mozCancelRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame))return window.setTimeout(e,n);var t=(new Date).getTime(),i=new Object;return i.value=window.requestAnimFrame(function r(){(new Date).getTime()-t>=n?e.call():i.value=window.requestAnimFrame(r)}),i},window.clearRequestTimeout=function(e){window.cancelAnimationFrame?window.cancelAnimationFrame(e.value):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(e.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(e.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(e.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(e.value):window.msCancelRequestAnimationFrame?window.msCancelRequestAnimationFrame(e.value):clearTimeout(e)};var virtualDom=function(){var e=!1,n=!0,t=!1;return{isInitialized:function(){return e},setInitialized:function(n){return e=n},requiresSync:function(){return n},setSync:function(e){return n=e},constrainDomUpdates:function(e){return t=e},getDomUpdatesLimit:function(){return t}}}(),createRunTime=function(e,n){var t,i,r,o,s,l,a=void 0,d=e.appFx[n],u=0,c={},p={},f=function(e){a=e},v=function(){return a},m=(t=null,i=null,r=void 0,o=void 0,s=function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];t=null,u++;var s=(r||randomStringId())+"_"+u,a=!!o;return r=void 0,window.requestTimeout(function(){h(s,n,a)},0),{done:l(s,a)}},l=function(e){return function(n){isNull(t)?p[e]=n:(delete c[e],n(t,i))}},{stamp:function(e){return r=e.id,o=e.priority,{msgs:s}},messages:s,setCallbackData:function(e,n){t=e,i=n}}),h=function(e,n){c[e]=[];for(var t=1;t<n.length;t++)c[e][t-1]=n[t];g(e,n[0])},y=function(e,n){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(isDefined(n))if(c[n].length>0)g(n,c[n].shift(),e);else if(delete c[n],isFunction(p[n])){var i=Object.assign({},p);delete p[n],i[n](e,t)}else m.setCallbackData(e,t)},g=function(e,n,t){var i=isFunction(n)?isDefined(t)?n(t,v()):n(v()):n;if(isNull(i))y(void 0,e);else{var r=i[1],o=i[2]||{};switch(i[0]){case"state":isDefined(o.syncNodes)?virtualDom.setSync(!1):virtualDom.setSync(!0),isDefined(o.maxDomUpdates)?virtualDom.constrainDomUpdates(o.maxDomUpdates):virtualDom.constrainDomUpdates(!1),b(r,e,!!o.preventRender);break;case"effect":var s=r.name,l=isFunction(s)?s:isDefined(d[s])?d[s]:function(){return console.warn("no effect '"+s+"' registered")},a=isArray(r.args)?l.apply(void 0,toConsumableArray(r.args)):l(r.args);a instanceof Promise?Promise.resolve(a).then(function(n){y(n,e)}).catch(function(n){y({error:!0,errorMsg:n},e)}):"_break_"===a?c[e]=[]:y(a,e);break;case"pipe":var u=r,f=u[0],m=null;if(u.length<2)m=f;else for(var h=1;h<u.length;h++)m=1===h?u[h](f):u[h](m);y(m,e);break;case"control":r.if||r.continue||isNumber(r.continue)?(!r.if&&isNumber(r.continue)&&(c[e].length=r.continue),y(r.if?r.isTrue:r.isFalse,e)):(c[e]=[],r.break?delete p[e]:y(r.isFalse,e,!1));break;case"cancel":var g=function(e){var n=!1;for(var t in c)0===t.indexOf(e)&&(n=!0,c[t]=[],delete p[t]);if(!n)for(var i in p)0===i.indexOf(e)&&delete p[i]},N=r.id;if(isDefined(N)){if(isArray(N))for(var w=0;w<N.length;w++)g(N);else g(N);y(void 0,e)}}}},b=function(t,i,r){var o=function e(n,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"default",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(isUndefined(t))f(i);else if(2==t.length){if("default"===r)return e(n[t[0]],t.slice(1),i,r,o,s);var l=n[t[0]];if(isNullorUndef(l))throw new Error('Karbon - cannot modify undefined array "'+t[0]+'".');if("splice"===r){var a=t[1];if(o>1){var d=[a,s];if(isArray(i))for(var u=0;u<i.length;u++)d[d.length]=i[u];else for(var c=0;c<o;c++)d[d.length]=i;l.splice.apply(l,d)}else if(isNotNull(i))l.splice(a,s,i);else{if(isNullorUndef(l[a]))throw new Error('Karbon - cannot remove. Array "'+t[0]+'" does not contain item at position "'+a+'".');l.splice(a,s)}}else if("delete"===r){var p=t[1];if(isNullorUndef(l[p]))throw new Error('Karbon - cannot delete undefined obj key "'+p+"\". Check that it wasn't removed in a previous action.");delete l[p]}}else{if(1!=t.length)return 0==t.length?n:e(n[t[0]],t.slice(1),i,r,o,s);var v=t[0];if(!isArray(v))return n[v]=i;for(var m=!!isArray(i),h=0;h<v.length;h++)n[v[h]]=m?i[h]:i}},s=isArray(t)?[]:isDefined(t.path)?t.path[0]:void 0;if(isArray(t))for(var l=0;l<t.length;l++){var d=t[l];o(a,d.path,d.value,d.action,d.add,d.remove),s[l]=d.path[0]}else o(a,t.path,t.value,t.action,t.add,t.remove);e.runHandleSubs(n),r?y(void 0,i):e.reRender(s,i,n)};return{setState:f,getState:v,exeQueuedMsgs:y,stamp:m.stamp,messages:m.messages}},voidedElements={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,animate:!0,animateTransform:!0,circle:!0,"color-profile":!0,ellipse:!0,feBlend:!0,feColorMatrix:!0,feComposite:!0,feConvolveMatrix:!0,feDisplacementMap:!0,feDistantLight:!0,feFlood:!0,feGaussianBlur:!0,feImage:!0,feMergeNode:!0,feMorphology:!0,feOffset:!0,fePointLight:!0,feSpotLight:!0,feTile:!0,feTurbulence:!0,"font-face-name":!0,image:!0,line:!0,mpath:!0,path:!0,polygon:!0,polyline:!0,set:!0,stop:!0,use:!0,view:!0,rect:!0},elProps=void 0,createVNode=function(e,n,t,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments[5],s=arguments[6],l=arguments[7],a=arguments[8],d={};elProps=Object.keys(t);for(var u=0;u<elProps.length;u++){var c=elProps[u],p=t[c];d[c]=isNull(p)?"":"innerHTML"!==c?p:'<span data="untracked-nodes">'+p+"</span>"}return{type:e,lang:a?"xml":"html",props:d,level:i,key:r,staticChildren:o,keyedAction:null,keyedChildren:null,parentComponent:s,parentComponentIndex:n,subscribesTo:l,dom:null}},actionsCache={},nodeBuilder=function(e,n){var t=[],i=[],r=[],o=[],s={},l=void 0,a=void 0,d=!1,u=void 0,c=void 0,p=void 0,f=1,v=!1,m=function(e){f--,"svg"!==e&&"/svg"!==e||(v=!1)},h=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{key:!1,staticChildren:!1};"svg"===e&&(v=!0),a=l.key,d=!1!==a,p=createVNode(e,r[r.length-1],n,f,a,l.staticChildren,i[i.length-1],o[o.length-1],v),t[t.length]=p,isDefined(c)&&f>u?c.keyedChildren[c.keyedChildren.length]=p:isDefined(c)&&f===u&&(c=void 0,u=void 0),d&&(u=f,c=p,p.keyedChildren=[],isUndefined(s[f])&&(s[f]={}),s[f][a]=p),voidedElements[e]||f++},y=function t(s){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Object.keys(s)[0],d=s[a],u=isUndefined(l.index)?0:l.index;i[i.length]=a,r[r.length]=u;var c=void 0,p=l.actions,f=function(n){var t=Object.keys(n)[0];isDefined(actionsCache[t])?c[t]=actionsCache[t]:(c[t]=n[t]({stamp:e.stamp,msgs:e.messages}),actionsCache[t]=c[t])};if(isDefined(p))if(c={},isArray(p))for(var v=0;v<p.length;v++)f(p[v]);else f(p);o[o.length]=isUndefined(l.subscribe)||"all"===l.subscribe?Object.keys(e.getState()):l.subscribe;var y=isDefined(l.mergeStateToProps)?l.mergeStateToProps(e.getState()):void 0;d(isDefined(y)?Object.assign({},l.props,y):l.props,isDefined(c)||isDefined(n)?Object.assign({},c,n):void 0,u)(h,m,t),o.length=o.length-1,i.length=i.length-1,r.length=r.length-1};return{renderRootComponent:function(e,n){y(e,n)},component:y,getKeyedNodes:function(){return s},getKeyedNodesPrev:function(){return l},setKeyedNodesPrev:function(){l=Object.assign({},s);for(var e=Object.keys(s),n=0;n<e.length;n++)delete s[e[n]]},getVDomNodesArray:function(){return t},resetVDomNodesArray:function(){t.length=0}}},nodeProps=void 0,elProps$1=void 0,el=void 0,isSVG=!1,createDomElement=function(e){nodeProps=e.props,elProps$1=Object.keys(nodeProps),"xml"!==e.lang?(isSVG=!1,el=document.createElement(e.type)):(isSVG=!0,el=document.createElementNS("http://www.w3.org/2000/svg",e.type));for(var n=function(e,n){var t=elProps$1[e],i=nodeProps[t];if(isObject(i))if(isDefined(i.length))if("class"===t){var r,o=i.filter(Boolean);if(o.length>0)(r=el.classList).add.apply(r,toConsumableArray(o))}else if("o"===t[0]&&"n"===t[1])el[t]=function(e){return i[0].apply(null,[].concat(toConsumableArray(i.slice(1)),[e]))};else for(var s=0;s<i.length;s++){var l=i[s].split("=");el.setAttribute(l[0],l[1])}else for(var a=Object.keys(i),d=0;d<a.length;d++){var u=a[d];el[t][u]=i[u]}else"text"===t?el.textContent=i:isDefined(el[t])&&!isSVG?el[t]=i:el.setAttribute(t,i)},t=0,i=elProps$1.length;t<i;t++)n(t);return el},props=[],values=[],newPropsKeys=void 0,prevPropsKeys=void 0,renderObj={should:null,action:null,keyedAction:null,untrackedHtmlNodes:null,props:null,values:null},updateRenderObj=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;renderObj.should=e,renderObj.action=n,renderObj.keyedAction=t,renderObj.untrackedHtmlNodes=untrackedHtmlNodes,renderObj.props=i,renderObj.values=r},prevProps=void 0,newProps=void 0,notChanged=void 0,untrackedHtmlNodes=void 0,handleKeyedNode=void 0,overrideDefaultAction=void 0,forceReplace=void 0,statefulElements={radio:!0},shouldRenderNode=function(e,n,t,i,r,o,s){if(prevProps=e.props,newProps=n.props,notChanged=!0,untrackedHtmlNodes=!1,handleKeyedNode=!1,forceReplace=!1,props.length=0,values.length=0,notChanged=!(n.type!==e.type||isNull(prevProps)||isNull(newProps)||isNotNull(n.keyedAction))&&objsAreEqual(prevProps,newProps),overrideDefaultAction=(i||r)&&o>s){if("removed"!==t.action)return updateRenderObj(!0,"newNode"),renderObj;if("removed"===t.action)return!1}if(notChanged)return!1;if(isNotNull(prevProps)&&isNotNull(newProps)){if(isDefined(newProps.innerHTML)&&(untrackedHtmlNodes=!0),statefulElements[prevProps.type]&&prevProps.type===newProps.type&&(forceReplace=!0),!1===n.key&&!1===e.key||!isNotNull(n.keyedAction)||(handleKeyedNode=!0),(n.type!==e.type||untrackedHtmlNodes||forceReplace)&&!handleKeyedNode)return updateRenderObj(!0,"replaceNode"),renderObj;newPropsKeys=Object.keys(newProps),prevPropsKeys=Object.keys(prevProps);for(var l=void 0,a=void 0,d=0;d<newPropsKeys.length;d++)l=newPropsKeys[d],a=newProps[l],isDefined(prevProps[l])?isArray(a)?arraysAreEqual(a,prevProps[l])||(props[props.length]=l,values[values.length]=a):isObject(a)?objsAreEqual(a,prevProps[l])||(props[props.length]=l,values[values.length]=a):a!==prevProps[l]&&(props[props.length]=l,values[values.length]=a):(props[props.length]=l,values[values.length]=a);for(var u=0;u<prevPropsKeys.length;u++){var c=prevPropsKeys[u];-1===newPropsKeys.indexOf(c)&&("innerHTML"!==c?(props[props.length]=c,values[values.length]="class"===c||"dataAttrs"===c?[]:""):(props.unshift(c),values.unshift("")))}return handleKeyedNode?(updateRenderObj(!0,"handleKeyedUpdate",n.keyedAction,props,values),renderObj):(updateRenderObj(!0,"updateNode",void 0,props,values),renderObj)}return isNull(prevProps)&&isNotNull(newProps)?(isDefined(newProps.innerHTML)&&(untrackedHtmlNodes=!0),"insertNew"===n.keyedAction?updateRenderObj(!0,"handleKeyedUpdate",n.keyedAction):updateRenderObj(!0,"newNode",e.keyedAction),renderObj):!(!isNotNull(prevProps)||!isNull(newProps))&&("recycled"===n.keyedAction?n.keyedAction:"recyclable"===n.keyedAction?(updateRenderObj(!0,n.keyedAction),renderObj):(updateRenderObj(!0,"removeNode"),renderObj))},firstChildNode=void 0,updateChangedNode=function(e,n,t){switch(e){case"class":var i;if(t.removeAttribute(e),n.length>0)(i=t.classList).add.apply(i,toConsumableArray(n.filter(Boolean)));break;case"style":for(var r=Object.keys(n),o="",s=0;s<r.length;s++){var l=r[s];isDefined(n[l])&&(o+=l+":"+n[l]+"; ")}""!==o?t.style.cssText=o:t.removeAttribute(e);break;case"text":t.hasChildNodes()?(firstChildNode=t.firstChild,isDefined(firstChildNode.data)?firstChildNode.data=n:t.insertBefore(document.createTextNode(n),firstChildNode)):t.textContent=n;break;case"dataAttrs":for(var a=0;a<t.attributes.length;a++)/^data-/i.test(t.attributes[a].name)&&(t.removeAttribute(t.attributes[a].name),a--);for(var d=0;d<n.length;d++){var u=n[d].split("=");t.setAttribute(u[0],u[1])}break;default:"o"===e[0]&&"n"===e[1]?(t[e]=null,t[e]=function(e){return n[0].apply(null,[].concat(toConsumableArray(n.slice(1)),[e]))}):isUndefined(t[e])||t instanceof SVGElement?t.setAttribute(e,n):""===n?(t[e]=!1,t.removeAttribute(e)):t[e]=n}},recycledVNodeStatic={type:null,lang:null,props:null,level:void 0,key:!1,keyedAction:"recycled",keyedChildren:null,staticChildren:!1,parentComponent:null,parentComponentIndex:null,subscribesTo:null,dom:null},recyclableVNodeStatic={type:null,lang:null,props:null,level:void 0,key:!1,keyedAction:"recyclable",keyedChildren:null,staticChildren:!1,parentComponent:null,parentComponentIndex:null,subscribesTo:null,dom:null},emptyVNodeStatic={type:null,lang:null,props:null,level:void 0,key:!1,keyedAction:null,keyedChildren:null,staticChildren:!1,parentComponent:null,parentComponentIndex:null,subscribesTo:null,dom:null},syncVNodes=function(e,n,t,i){for(var r=void 0,o=void 0,s=!1,l=function(l){if(r=n[l],o=e[l],s=!1,isUndefined(r)?n[l]=emptyVNodeStatic:r.level>o.level?e.splice(l,0,emptyVNodeStatic):r.level<o.level&&n.splice(l,0,emptyVNodeStatic),l===e.length-1){var a=n.length-e.length;if(a>0)for(var d=1;d<=a;d++)e[e.length]=emptyVNodeStatic,s=!0}r=n[l],o=e[l];var u=i[o.level||r.level];if(isDefined(u)){var c=void 0,p=void 0,f=void 0;if(isNotFalse(o.key)&&r.key!==o.key){c=isDefined(u[r.key]),p=!isUndefined(t[o.level])&&isDefined(t[o.level][r.key]),o.level<=f&&(f=void 0),f=isDefined(f)?f:o.level;var v=u[o.key],m=function(){if(v.keyedChildren.length>0){for(var e=0;isDefined(n[l+e+1])&&n[l+e+1].level>f;)e++;n.splice.apply(n,[l+1,e].concat(toConsumableArray(v.keyedChildren)))}};isDefined(v)?(isNull(r.props)||isNotFalse(r.key)&&!c?(n[l]=v,o.keyedAction="insertOld",m()):isFalse(r.key)||!p?(e.splice(l,0,emptyVNodeStatic),o=e[l]):(n[l]=v,o.keyedAction="swap",m()),delete u[o.key]):(isNull(r.props)?n[l]=emptyVNodeStatic:n.splice(l,0,emptyVNodeStatic),o.keyedAction="insertNew")}else if(isNotFalse(o.key)&&r.key===o.key)o.keyedAction="updateAttrs";else if(isNotFalse(r.key)&&r.key!==o.key){c=isDefined(u[r.key]),p=!isUndefined(t[r.level])&&isDefined(t[r.level][r.key]);var h=function(){if(r.keyedChildren.length>0){for(var e=0;isDefined(n[l+e+1])&&n[l+e+1].level>r.level;)e++;n.splice(l+1,e)}};isNotNull(o.props)?c&&p?(n.splice(l,0,emptyVNodeStatic),o.keyedAction="insertNew",h()):!c&&p?(e.splice(l,0,recycledVNodeStatic),h()):p||(r.key=!1):p?(e[l]=recyclableVNodeStatic,h()):r.key=!1}}if(s&&e.length===n.length)return"break"},a=0;a<e.length;a++){if("break"===l(a))break}return{domNodes:e,domNodesPrev:n}},getNodeRelations=function(e,n,t,i,r,o,s,l,a,d){var u=void 0,c="child",p=void 0,f=null,v=null,m=null,h=isUndefined(i)?-1:isNotNull(i.props)?i.level:s.level,y=isUndefined(r)?void 0:isNotNull(r.props)?r.level:l.level;return e>0&&(h<a?(u="parent",c="child"):h>a?(u="child",c="parent"):(u="child",c="sibling"),isDefined(s)&&isNull(i.props&&isNotNull(s.props))&&(m="removed")),e<n.length-d-1&&(p=y<a?"parent":y>a?"child":"sibling",isNull(r.props)&&(v="removed"),isDefined(l)&&isNull(l.props)&&(v="add")),isNull(t.props)&&(f="removed"),isDefined(o)&&isNull(o.props)&&(f="add"),{previous:u,current:c,next:p,action:f,actionNext:v,actionPrev:m,nextNodeLevel:y}},childNodeIndexes=[],createView=function(e,n,t,i,r,o){var s=!1,l=!1,a=!1,d=null,u={};if(childNodeIndexes.length=0,virtualDom.isInitialized()&&virtualDom.requiresSync()){var c=syncVNodes(n.slice(0),t,r,o);n=c.domNodes,t=c.domNodesPrev}for(var p=function(e,n){switch(e.current){case"parent":childNodeIndexes[n]++;break;case"child":childNodeIndexes[n]=0;break;case"sibling":childNodeIndexes[n]++}},f=function(e,n,t){for(var i=0;i<e.length;i++)updateChangedNode(e[i],n[i],t)},v=function(e,n,t,i,r){if(C=shouldRenderNode(e,n,t,s,l,r,d),r<=d&&(s=!1,l=!1),C.should){switch(a&&childNodeIndexes[r]++,C.action){case"updateNode":y=e.dom,n.dom=y,f(C.props,C.values,y),S++;break;case"newNode":y=createDomElement(n),n.dom=y,i.appendChild(y),S++;break;case"replaceNode":y=createDomElement(n),n.dom=y,function(e,n,t,i){isDefined(t)&&isNotNull(t)?e.replaceChild(n,t):e.appendChild(n),s=!0,d=i}(i,y,e.dom,r),S++;break;case"removeNode":var o=e.dom;isNotNullandIsDef(o)&&(i.removeChild(o),o=null,childNodeIndexes[r]--,l=!0,d=r,S++);break;case"recyclable":isUndefined(u[e.key])?u[e.key]=!0:childNodeIndexes[r]--;break;case"handleKeyedUpdate":var c=j(),p=e.dom,v=C.keyedAction;y=p,"insertNew"===v?(y=createDomElement(n),i.insertBefore(y,c),S++):"insertOld"===v?(i.insertBefore(p,c),u[n.key]=!0,S++,C.props.length>0&&f(C.props,C.values,y)):"swap"===v||isDefined(c)&&!c.isEqualNode(p)?(m=i,h=c,(b=(g=p).nextSibling)===h?m.insertBefore(h,g):m.insertBefore(g,h),isDefined(h)&&m.insertBefore(h,b),u[n.key]=!0,S++,C.props.length>0&&f(C.props,C.values,y)):"updateAttrs"===v&&C.props.length>0&&(f(C.props,C.values,y),S++),n.dom=y}a=!(!C.untrackedHtmlNodes||"child"!==t.next||"removed"===t.actionNext)}else n.dom=e.dom,y=n.dom,"recycled"===C&&childNodeIndexes[r]--;var m,h,g,b},m=[],h=void 0,y=void 0,g=void 0,b=void 0,N=void 0,w=void 0,k=void 0,A=!1,C=void 0,D=0,P=0,S=0,O=!1,j=function(){return h.children[function(e){return childNodeIndexes[e]}(w)]},x=0,F=n.length;x<F;x++)if((O||virtualDom.getDomUpdatesLimit()===S)&&(O=!0),O)b=n[x],N=t[x],b.dom=N.dom,y=b.dom;else{if(P>0&&(x+=P,P=0),b=n[x],N=t[x],isUndefined(b))break;if(virtualDom.isInitialized()&&b.staticChildren&&"insertNew"!==b.keyedAction&&isNotNull(b.keyedAction)&&isDefined(N)&&isNotNull(N.props)&&(P=b.keyedChildren.length),w=b.level||N.level,p(k=getNodeRelations(x,n,b,n[x-1],n[x+P+1],N,t[x-1],t[x+P+1],w,P),w),0!==x?isDefined(g)&&w===D?h=g:g=h=m[m.length-1]:(h=e,m[0]=h),virtualDom.isInitialized()){A=!1;var R=b.subscribesTo||N.subscribesTo;if(isDefined(i)&&isNotNull(R)&&!A){for(var T=0;T<R.length;T++)if(i.indexOf(R[T])>-1){A=!0;break}}else isNull(R)||(A=!0);A?v(N,b,k,h,w):N.parentComponent===b.parentComponent&&isNotNull(b.props)&&isNotNull(N.props)&&!s&&!l&&b.type===N.type&&"insertOld"!==b.keyedAction?(b.dom=N.dom,y=b.dom):v(N,b,k,h,w)}else y=createDomElement(b),h.appendChild(y),b.dom=y;"child"===k.next&&"removed"!==k.action?m[m.length]=y:"parent"===k.next&&m.splice(k.nextNodeLevel,w-k.nextNodeLevel),D=w}},vdomNodeBuilder=void 0,vDomNodesArrayPrevious=[],renderApp=function(e,n,t,i,r,o,s,l,a,d){var u=void 0;l?((vdomNodeBuilder=isDefined(vdomNodeBuilder)?vdomNodeBuilder:{})[d]=nodeBuilder(t,i,o),u=vdomNodeBuilder[d]):(u=vdomNodeBuilder[d],vDomNodesArrayPrevious=u.getVDomNodesArray().slice(0),u.resetVDomNodesArray()),u.setKeyedNodesPrev(),u.renderRootComponent({$$_appRootView:n},{props:t.getState()}),createView(e,u.getVDomNodesArray(),vDomNodesArrayPrevious,o,u.getKeyedNodes(),u.getKeyedNodesPrev(),d),l?(isFunction(r)&&r(i),a&&(virtualDom.setInitialized(!0),virtualDom.setSync(!0))):t.exeQueuedMsgs(void 0,s)},karbon={run:function(){this.runTime={},this.appRootComponent={},this.appRootActions={},this.appContainer={},this.appView={},this.appGlobalActions={},this.appRootSubscribe={},this.appSubs={},this.appFx={},this.appOnInit={};for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];for(var i=0;i<n.length;i++){var r=n[i],o=i,s=i===n.length-1;r.container.innerHTML="",this.appContainer[o]=r.container,this.appFx[o]=r.effects,this.appSubs[o]=r.subscriptions,this.runTime[o]=createRunTime(this,o),this.runTime[o].setState(r.state),this.appView[o]=r.view,this.appGlobalActions[o]=this.initGlobalActions(r.actions,this.runTime[o]),this.appOnInit[o]=r.init,this.runHandleSubs(o),renderApp(this.appContainer[o],this.appView[o],this.runTime[o],this.appGlobalActions[o],this.appOnInit[o],void 0,void 0,!0,s,o)}},initGlobalActions:function(e,n){var t={},i=function(e){var i=Object.keys(e)[0];t[i]=e[i]({stamp:n.stamp,msgs:n.messages})};if(isDefined(e)){if(isArray(e))for(var r=0;r<e.length;r++)i(e[r]);else i(e);return t}},handleSubs:function(e,n){for(var t=0;t<e.length;t++){var i=e[t],r=isArray(i.action)?i.action[0]:i.action;isUndefined(r.name)&&Object.defineProperty(r.prototype,"name",{get:function(){return/function ([^(]*)/.exec(this+"")[1]}});var o=i.id||r.name+"_"+i.name.toString().replace(/\s/g,"");if(isFunction(i.name))i.name({opts:i.options,action:r,actionArgs:isArray(i.action)?i.action.slice(1):[],condition:!!isNullorUndef(i.when)||i.when,subId:o,subCache:subscription.getCache()});else if(isString(i.name)){var s;i.when||isUndefined(i.when)?isDefined(i.name)?isDefined(subscription.getCache()[o])||subscription.add(i.el||window,i.name,o,r,isArray(i.action)?i.action.slice(1):void 0):isArray(i.action)?(s=i.action)[0].apply(s,toConsumableArray(i.action.slice(1))):i.action():i.when||isDefined(i.name)&&isDefined(subscription.getCache()[o])&&subscription.remove(i.el||window,i.name,o)}}},runHandleSubs:function(e){isFunction(this.appSubs[e])&&this.handleSubs(this.appSubs[e](this.runTime[e].getState(),this.appGlobalActions[e]),e)},reRender:function(e,n,t){renderApp(this.appContainer[t],this.appView[t],this.runTime[t],this.appGlobalActions[t],void 0,e,n,!1,void 0,t,void 0)}},run=void 0;document.currentScript&&"noModule"in document.currentScript?run=karbon.run.bind(karbon):(window.karbon={},window.karbon.run=karbon.run.bind(karbon));export{run};
