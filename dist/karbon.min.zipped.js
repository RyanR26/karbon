var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},slicedToArray=function(){return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,n){var t=[],r=!0,o=!1,i=void 0;try{for(var d,s=e[Symbol.iterator]();!(r=(d=s.next()).done)&&(t.push(d.value),!n||t.length!==n);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return t}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)},isUndefined=function(e){return void 0===e},isDefined=function(e){return void 0!==e},isNull=function(e){return null===e},isNotNull=function(e){return null!==e},isNullorUndef=function(e){return isUndefined(e)||isNull(e)},isNotNullandIsDef=function(e){return null!==e&&void 0!==e},isEmpty=function(e){return""===e},isNotEmpty=function(e){return""!==e},isFunction=function(e){return"function"==typeof e},isObject=function(e){return"object"===(void 0===e?"undefined":_typeof(e))},isArray=Array.isArray,isNumber=function(e){return"number"==typeof e},isString=function(e){return"string"==typeof e},isPromise=function(e){return e instanceof Promise},randomStringId=function(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(2,10)},isBrowser=function(){return"object"===("undefined"==typeof window?"undefined":_typeof(window))},clearObject=function(e){for(var n in e)delete e[n]},arraysAreEqual=function(e,n){if(e.length!==n.length)return!1;for(var t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0},keyList=Object.keys,hasProp=Object.prototype.hasOwnProperty,objsAreEqual=function e(n,t){if(n===t)return!0;if(n&&t&&"object"==(void 0===n?"undefined":_typeof(n))&&"object"==(void 0===t?"undefined":_typeof(t))){var r=isArray(n),o=isArray(t),i=void 0,d=void 0,s=void 0;if(r&&o){if((d=n.length)!=t.length)return!1;for(i=d;0!=i--;)if(!e(n[i],t[i]))return!1;return!0}var l=keyList(n);if((d=l.length)!==keyList(t).length)return!1;for(i=d;0!=i--;)if(!hasProp.call(t,l[i]))return!1;for(i=d;0!=i--;)if(!e(n[s=l[i]],t[s]))return!1;return!0}return n!=n&&t!=t},virtualDom=function(){var e=!1,n=!0,t=!1;return{isInitialized:function(){return e},setInitialized:function(n){return e=n},requiresSync:function(){return n},setSync:function(e){return n=e},constrainDomUpdates:function(e){return t=e},getDomUpdatesLimit:function(){return t}}}(),createRunTime=function(e,n){var t,r,o,i,d,s,l,a=void 0,c=[],u=0,p={},f={},v=void 0,h=function(e){a=e},y=function(){return a},m=(t=null,r=null,o=null,i=void 0,d=void 0,s=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];t=null,o=Object.assign({},d),u++;var s=(i||randomStringId())+"_"+u;return d=void 0,i=void 0,setTimeout(function(){g(s,n,o)},0),{done:l(s)}},l=function(e){return function(n){isNull(t)?f[e]=n:(delete p[e],n(t,r,o))}},{stamp:function(e){return i=e.id,d=e.cache,{msgs:s}},messages:s,setCallbackData:function(e,n,i){t=e,r=n,o=i}}),g=function(e,n,t){p[e]=[];for(var r=1;r<n.length;r++)p[e][r-1]=n[r];b(e,n[0],v,t)},N=function(e,n){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments[3];if(isDefined(n))if(p[n].length>0)b(n,p[n].shift(),e,r);else if(delete p[n],isFunction(f[n])){var o=Object.assign({},f);delete f[n],o[n](e,t,r)}else m.setCallbackData(e,t,r)},b=function(e,n,t,r){var o=isFunction(n)?isNotNullandIsDef(t)?n("undefined"===t?void 0:t,y(),r):n(y(),r):n;if(isNull(o))N(null,e,v,r);else if(isUndefined(o))N("undefined",e,v,r);else{var i=o[1],d=o[2]||{};switch(o[0]){case"state":d.fixedDomShape?virtualDom.setSync(!1):virtualDom.setSync(!0),isDefined(d.maxDomUpdates)?virtualDom.constrainDomUpdates(d.maxDomUpdates):virtualDom.constrainDomUpdates(!1),S(i,e,!!d.preventRender,r);break;case"effect":var s=i.cache,l=i.name||i.def,a=isFunction(l)?l:function(){return console.warn("Effect '"+l+"' is not a function.")},c=isArray(i.args)?a.apply(void 0,toConsumableArray(i.args)):a(i.args);isPromise(c)?Promise.resolve(c).then(function(n){isDefined(s)&&(r[s]=n),N(n,e,v,r)}).catch(function(n){isDefined(s)&&(r[s]=n),N({error:!0,errorMsg:n},e,v,r)}):"_break_"===c?p[e]=[]:(isDefined(s)&&(r[s]=c),N(c,e,v,r));break;case"pipe":var u=i,h=u[0],m=null;if(u.length<2)m=h;else for(var g=1;g<u.length;g++)m=1===g?u[g](h):u[g](m);N(m,e,v,r);break;case"control":var b=!!i.if,k=isArray(i[b]),A=k?i[b][0]:i[b],C=k?i[b][1]:null,D=k?i[b][2]:null,O=i.cache,w=!1;C?"continue"===C?isNumber(D)&&(p[e].length=D):"skip"===C&&D?isNumber(D)&&p[e].splice(0,D):"break"===C&&(p[e]=[],delete f[e]):b?w=!0:p[e]=[],isDefined(O)&&(r[O]=A),N(A,e,w,r);break;case"cancel":var L=function(e){var n=!1;for(var t in p)0===t.indexOf(e)&&(n=!0,p[t]=[],delete f[t]);if(!n)for(var r in f)0===r.indexOf(e)&&delete f[r]},_=i.id;if(isDefined(_)){if(isArray(_))for(var R=0;R<_.length;R++)L(_);else L(_);N(void 0,e)}}}},k=function e(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"default",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(isUndefined(t))h(r);else if(2==t.length){if("default"===o)return e(n[t[0]],t.slice(1),r,o,i,d);var s=n[t[0]];if(isNullorUndef(s))throw new Error('Karbon - cannot modify undefined array "'+t[0]+'".');if("splice"===o){var l=t[1];if(i>1){var a=[l,d];if(isArray(r))for(var c=0;c<r.length;c++)a[a.length]=isFunction(r[c])?r(s):r[c];else for(var u=0;u<i;u++)a[a.length]=isFunction(r)?r(s):r;s.splice.apply(s,a)}else if(isNotNull(r))s.splice(l,d,isFunction(r)?r(s):r);else{if(isNullorUndef(s[l]))throw new Error('Karbon - cannot remove. Array "'+t[0]+'" does not contain item at position "'+l+'".');s.splice(l,d)}}else if("delete"===o){var p=t[1];if(isNullorUndef(s[p]))throw new Error('Karbon - cannot delete undefined obj key "'+p+"\". Check that it wasn't removed in a previous action.");delete s[p]}}else{if(1!=t.length)return 0==t.length?n:e(n[t[0]],t.slice(1),r,o,i,d);var f=t[0];if(isArray(f))for(var v=0;v<f.length;v++)isArray(r)?n[f[v]]=isFunction(r[v])?r(n[f[v]]):r[v]:n[f[v]]=isFunction(r)?r(n[f[v]]):r;else n[f]=isFunction(r)?r(n[f]):r}},S=function(t,r,o,i){var d=isArray(t)?[]:isDefined(t.path)?t.path[0]:void 0;if(isArray(t))for(var s=0;s<t.length;s++){var l=t[s];k(a,l.path,l.value,l.action,l.add,l.remove),d[s]=l.path[0]}else k(a,t.path,t.value,t.action,t.add,t.remove);e.runHandleSubs(n),o?N(v,r,v,i):e.reRender(d,r,n,i)};return{setState:h,getState:y,setLocalSubs:function(e){c=[].concat(toConsumableArray(c),toConsumableArray(e))},getLocalSubs:function(){return c},exeQueuedMsgs:N,forceReRender:function(t){virtualDom.setSync(!0),e.reRender(void 0,void 0,n,void 0,t)},stamp:m.stamp,messages:m.messages}},voidedElements={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,animate:!0,animateTransform:!0,circle:!0,"color-profile":!0,ellipse:!0,feBlend:!0,feColorMatrix:!0,feComposite:!0,feConvolveMatrix:!0,feDisplacementMap:!0,feDistantLight:!0,feFlood:!0,feGaussianBlur:!0,feImage:!0,feMergeNode:!0,feMorphology:!0,feOffset:!0,fePointLight:!0,feSpotLight:!0,feTile:!0,feTurbulence:!0,"font-face-name":!0,image:!0,line:!0,mpath:!0,path:!0,polygon:!0,polyline:!0,set:!0,stop:!0,use:!0,view:!0,rect:!0},createVNode=function(e,n,t,r){for(var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments[5],d=arguments[6],s=arguments[7],l=arguments[8],a=arguments[9],c=arguments[10],u=arguments[11],p={},f=Object.keys(t),v=0;v<f.length;v++){var h=f[v],y=t[h];p[h]=isNull(y)?"":"innerHTML"!==h?y:'<span data="dangerously-set-innerHTML">'+y+"</span>"}return{type:e,lang:l?"xml":"html",props:p,level:r,key:o,staticChildren:i,keyedAction:null,keyedChildren:null,parentComponent:d,parentComponentIndex:n,subscribesTo:s,dom:null,block:a,blockProps:c,blockChild:u}},nodeBuilder=function(e,n){var t=[],r=[],o=[],i=[],d={},s={},l={},a={},c=[],u=!1,p=void 0,f=void 0,v=!1,h=void 0,y=void 0,m=void 0,g=1,N=!1,b=0,k=void 0,S=[],A=function(e){g--,"svg"!==e&&"/svg"!==e||(N=!1)},C=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{key:!1,staticChildren:!1},l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments[4];if("svg"===e&&(N=!0),f=s.key,v=!!f,m=createVNode(e,o[o.length-1],n,g,f,s.staticChildren,r[r.length-1],i[i.length-1],N,l,a,!1),"creatingHydrationLayer"===k&&Object.keys(m.props).map(function(e){"o"===e[0]&&"n"===e[1]&&(m.props[e]="")}),u)return c[c.length]=m,void(voidedElements[e]||g++);t[t.length]=m,isDefined(y)&&(g>h?(y.keyedChildren[y.keyedChildren.length]=m,m.block&&(y.blockChild=!0)):g===h&&(y=void 0,h=void 0)),v&&(h=g,y=m,m.keyedChildren=[],d[f]=m),voidedElements[e]||g++},D=function t(d){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};isArray(d)&&(l=d[1]||{},d=d[0]);var a=Object.keys(d)[0],c=d[a],u=l.index||0;r[r.length]=a,o[o.length]=u;var p=void 0,f=l.actions;if(isDefined(f)){p={},f=isArray(f)?f:[f];for(var v=0;v<f.length;v++){var h=f[v],y=Object.keys(h)[0];isDefined(s[y])?p[y]=s[y]:(p[y]=h[y]({stamp:e.stamp,msgs:e.messages}),s[y]=p[y])}}var m,g=l.subscriptions;isDefined(g)&&(m=g(e.getState(),p),S=[].concat(toConsumableArray(S),toConsumableArray(m))),i[i.length]=isUndefined(l.subscribe)||"all"===l.subscribe?Object.keys(e.getState()):l.subscribe;var N=isDefined(l.mergeStateToProps)?l.mergeStateToProps(e.getState()):void 0;c(isDefined(N)?Object.assign({},l.props,N):l.props,isDefined(p)||isDefined(n)?Object.assign({},p,n):void 0,u)(C,A,{component:t,lazy:O,block:w}),i.length=i.length-1,r.length=r.length-1,o.length=o.length-1},O=function(n,t,r,o,i){var d=n.toString().replace(/ /g,""),s="creatingHydrationLayer"===k;if("error"===l[d])isFunction(o)&&o();else if(isDefined(l[d])){var a=l[d][0];b>0&&"loading"!==l[d]&&b--,isFunction(a)&&a(l[d][1])}else{if("loading"!==l[d])isFunction(r)&&r(),l[d]="loading",b++,(isPromise(n)?Promise.resolve(n):n()).then(function(n){setTimeout(function(){l[d]=[t,n],e.forceReRender(s),isBrowser()&&!s&&window.dispatchEvent(new CustomEvent("Lazy_Component_Rendered",{detail:{key:d}}))},i||0)}).catch(function(n){console.error(n),l[d]="error",e.forceReRender(s),isBrowser()&&!s&&window.dispatchEvent(new CustomEvent("Lazy_Component_Error",{detail:{key:d}}))})}},w=function(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"div";u=!0;var o="";if(t)for(var i=Object.keys(t),d=0;d<i.length;d++){var s=i[d];t[s].id=t[s].id||e+"_"+s}a[e]?o=!0:(n(t),o=c.slice(0),a[e]=o),u=!1,C(r,{},{key:e},o,t),"toString"===k&&n(t),A(),c.length=0};return{renderRootComponent:function(e,n,t){k=t,D(e,n)},component:D,getKeyedNodes:function(){return d},getKeyedNodesPrev:function(){return p},setKeyedNodesPrev:function(){p=Object.assign({},d),clearObject(d)},getVDomNodesArray:function(){return t},resetVDomNodesArray:function(){t.length=0},getLazyCount:function(){return b},getBlockCache:function(){return a},getLocalSubs:function(){return S},resetLocalSubs:function(){S.length=0}}},documentCreateElement=function(e,n){return n?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e)},createDomElement=function(e){for(var n=e.props,t=Object.keys(n),r="xml"===e.lang,o=documentCreateElement(e.type,r),i=function(e,i){var d=t[e],s=n[d];if(isObject(s))if(isDefined(s.length))if("class"===d){var l,a=s.filter(Boolean);if(a.length>0)(l=o.classList).add.apply(l,toConsumableArray(a))}else if("o"===d[0]&&"n"===d[1])o[d]=function(e){return s[0].apply(null,[].concat(toConsumableArray(s.slice(1)),[e]))};else for(var c=0;c<s.length;c++){var u=s[c].split("=");o.setAttribute("data-"+u[0],u[1]||"")}else for(var p=Object.keys(s),f=0;f<p.length;f++){var v=p[f];o[d][v]=s[v]}else"text"===d?o.textContent=s:"class"===d?isNotEmpty(s)&&(o.className=s):isDefined(o[d])&&!r?o[d]=s:o.setAttribute(d,s)},d=0,s=t.length;d<s;d++)i(d);return o},createFragment=function(e){var n=document.createDocumentFragment(),t=[n],r=0;return e.map(function(e){e.level===r?t.length=t.length-1:e.level<r&&(t.length=t.length-(r-e.level));var n=createDomElement(e);t[t.length-1].appendChild(n),t[t.length]=n,r=e.level}),n},getChangedNodeProps=function(e,n){for(var t=[],r=[],o=Object.keys(n),i=Object.keys(e),d=void 0,s=void 0,l=0;l<o.length;l++)s=n[d=o[l]],isDefined(e[d])?isArray(s)?arraysAreEqual(s,e[d])||(t[t.length]=d,r[r.length]=s):isObject(s)?objsAreEqual(s,e[d])||(t[t.length]=d,r[r.length]=s):s!==e[d]&&(t[t.length]=d,r[r.length]=s):(t[t.length]=d,r[r.length]=s);for(var a=0;a<i.length;a++){var c=i[a];-1===o.indexOf(c)&&("innerHTML"!==c?(t[t.length]=c,r[r.length]="data"===c?[]:""):(t.unshift(c),r.unshift("")))}return{props:t,values:r}},statefulElements={radio:!0},renderObj={should:null,action:null,keyedAction:null,untrackedHtmlNodes:null,props:null,values:null},updateRenderObj=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];renderObj.should=e,renderObj.action=n,renderObj.keyedAction=t,renderObj.untrackedHtmlNodes=i,renderObj.props=r,renderObj.values=o},shouldRenderNode=function(e,n,t,r,o,i,d){if(e.block&&n.block)return(!isNull(n.keyedAction)||!isUndefined(n.blockProps)&&!objsAreEqual(e.blockProps,n.blockProps))&&("insertOld"===n.keyedAction?updateRenderObj(!0,"handleKeyedUpdate","insertOld",e.blockProps,n.blockProps,!0):updateRenderObj(!0,"handleKeyedUpdate","runBlockUpdates",e.blockProps,n.blockProps,!0),renderObj);var s=e.props,l=n.props,a=!0,c=!1,u=!1,p=!1;if(a=!(n.type!==e.type||isNull(s)||isNull(l)||isNotNull(n.keyedAction))&&objsAreEqual(s,l),(r||o)&&i>d)return"removed"!==t.action&&("insertNew"===n.keyedAction?updateRenderObj(!0,"handleKeyedUpdate","insertNew"):updateRenderObj(!0,"newNode"),renderObj);if(a)return!1;if(isNotNull(s)&&isNotNull(l)){if(isDefined(l.innerHTML)&&(c=!0),statefulElements[s.type]&&s.type===l.type&&(p=!0),!1===n.key&&!1===e.key||!isNotNull(n.keyedAction)||(u=!0),(n.type!==e.type||c||p)&&!u)return updateRenderObj(!0,"replaceNode",void 0,void 0,void 0,c),renderObj;var f=getChangedNodeProps(s,l),v=f.props,h=f.values;return u?(updateRenderObj(!0,"handleKeyedUpdate",n.keyedAction,v,h),renderObj):(updateRenderObj(!0,"updateNode",void 0,v,h),renderObj)}return isNull(s)&&isNotNull(l)?(isDefined(l.innerHTML)&&(c=!0),"insertNew"===n.keyedAction?updateRenderObj(!0,"handleKeyedUpdate","insertNew",void 0,void 0,c):updateRenderObj(!0,"newNode",e.keyedAction,void 0,void 0,c),renderObj):!(!isNotNull(s)||!isNull(l))&&("recycled"===n.keyedAction?"recycled":"recyclable"===n.keyedAction?(updateRenderObj(!0,"recyclable"),renderObj):(updateRenderObj(!0,"removeNode"),renderObj))},updateChangedNode=function(e,n,t){switch(console.log(e,n,t),e){case"class":if(t.removeAttribute(e),isString(n)&&isNotEmpty(n))t.className=n;else if(isArray(n)&&n.length>0){var r;(r=t.classList).add.apply(r,toConsumableArray(n.filter(Boolean)))}break;case"style":for(var o=Object.keys(n),i="",d=0;d<o.length;d++){var s=o[d];isDefined(n[s])&&(i+=s+":"+n[s]+"; ")}isNotEmpty(i)?t.style.cssText=i:t.removeAttribute(e);break;case"text":if(t.hasChildNodes()){var l=t.firstChild;isDefined(l.data)?l.data=n:t.insertBefore(document.createTextNode(n),l)}else t.textContent=n;break;case"data":console.log(n);for(var a=0;a<t.attributes.length;a++)/^data-/i.test(t.attributes[a].name)&&(t.removeAttribute(t.attributes[a].name),a--);for(var c=0;c<n.length;c++){var u=n[c].split("=");t.setAttribute("data-"+u[0],u[1]||"")}break;default:"o"===e[0]&&"n"===e[1]?isString(n)?t[e]=null:isArray(n)?t[e]=function(e){return n[0].apply(null,[].concat(toConsumableArray(n.slice(1)),[e]))}:t[e]=function(e){return n.apply(null,[e])}:isUndefined(t[e])||t instanceof SVGElement?t.setAttribute(e,n):isEmpty(n)?(t[e]=!1,t.removeAttribute(e)):t[e]=n}},emptyVNodeStatic={type:null,lang:null,props:null,level:void 0,key:!1,keyedAction:null,keyedChildren:null,staticChildren:!1,parentComponent:null,parentComponentIndex:null,subscribesTo:null,dom:null,block:!1,blockProps:void 0,blockChild:!1},recycledVNodeStatic=Object.assign({},emptyVNodeStatic,{keyedAction:"recycled"});function syncLists(e,n,t,r,o){var i=[],d=[],s=0,l=0,a=n.length-1,c=e.length-1;function u(e,n){if(isDefined(n)&&r[n.key]){n.keyedAction="insertOld",i[i.length]=n,d[d.length]=r[n.key];var o=syncLists(r[n.key].keyedChildren,n.keyedChildren,t,r),a=slicedToArray(o,2),c=a[0],u=a[1];d=d.concat(c),i=i.concat(u),l+=isDefined(e)&&isNotNull(e.keyedChildren)?e.keyedChildren.length+1:0,s=s+n.keyedChildren.length+1,delete r[n.key]}else n.keyedAction="insertNew",i[i.length]=n,d[d.length]=emptyVNodeStatic,s++}function p(e){e.block?o[e.key]=!1:e.blockChild&&e.keyedChildren.map(function(e){e.block&&(o[e.key]=!1)})}function f(e,n){isUndefined(e)||isDefined(n)&&e.level<n.level?n.key?u(e,n):(d[d.length]=emptyVNodeStatic,i[i.length]=n,s++):isUndefined(n)||isDefined(e)&&e.level>n.level?e.key&&!r[e.key]&&t[e.key]?function(e){i[i.length]=recycledVNodeStatic,d[d.length]=e,l=l+e.keyedChildren.length+1}(e):(i[i.length]=emptyVNodeStatic,d[d.length]=e,l++,p(e)):e.key?e.key===n.key?function(e,n){n.keyedAction="updateAttrs",i[i.length]=n,d[d.length]=e,s++,l++,delete r[n.key]}(e,n):t[e.key]?u(e,n):function(e){i[i.length]=emptyVNodeStatic,d[d.length]=e,l=l+e.keyedChildren.length+1,p(e)}(e):n.key?(i[i.length]=emptyVNodeStatic,d[d.length]=e,l++):(i[i.length]=n,d[d.length]=e,s++,l++)}for(;s<=a||l<=c;)f(e[l],n[s]);return[d,i]}var syncVNodes=function(e,n,t,r,o){var i=void 0;if(0===e.length)for(var d=0;d<n.length;d++)e[d]=emptyVNodeStatic;else i=syncLists(n,e,t,r,o);return{domNodes:i[1],domNodesPrev:i[0]}},getNodeRelations=function(e,n,t,r,o,i,d,s,l){var a=void 0,c="child",u=void 0,p=null,f=null,v=null,h=isUndefined(r)?-1:isNotNull(r.props)?r.level:d.level,y=isUndefined(o)?void 0:isNotNull(o.props)?o.level:s.level;return e>0&&(h<l?(a="parent",c="child"):h>l?(a="child",c="parent"):(a="child",c="sibling"),isDefined(d)&&isNull(r.props)&&isNotNull(d.props)&&(v="removed")),e<n.length-1&&(u=y<l?"parent":y>l?"child":"sibling",isNull(o.props)?f="removed":isDefined(s)&&isNull(s.props)&&(f="add")),isNull(t.props)?p="removed":isDefined(i)&&isNull(i.props)&&(p="add"),{previous:a,current:c,next:u,action:p,actionNext:f,actionPrev:v,nextNodeLevel:y}},keyedNodeRecycleBin={},$_parentNodeStack=[],childNodeIndexes=[],nodeReplacedFlag=void 0,nodeRemovedFlag=void 0,handleUntrackedHtmlNodesFlag=void 0,forceUpdateStartLevel=void 0,$_parentNode=void 0,$_currentNode=void 0,$_prevParentCache=void 0,node=void 0,prevNode=void 0,currentLevel=void 0,nR=void 0,nodeIsListeningToStateKey=void 0,renderNode=void 0,prevLevel=void 0,domOpsCount=void 0,domOpsComplete=void 0,syncedVNodes=void 0,subscribesTo=void 0,getDomIndex=function(e){return childNodeIndexes[e]},updateChildNodeFauxDomIndexes=function(e,n){switch(e.current){case"parent":childNodeIndexes[n]++;break;case"child":childNodeIndexes[n]=0;break;case"sibling":childNodeIndexes[n]++}},replaceNode=function(e,n,t){isDefined(t)&&isNotNull(t)?e.replaceChild(n,t):e.appendChild(n)},swapElements=function(e,n,t){var r=t.nextSibling;r===n?e.insertBefore(n,t):e.insertBefore(t,n),isDefined(n)&&e.insertBefore(n,r)},updateProperties=function(e,n,t){for(var r=0;r<e.length;r++)updateChangedNode(e[r],n[r],t)},updateBlockProperties=function(e){for(var n=Object.keys(e.values),t=0;t<n.length;t++){var r=n[t],o=e.values[r],i=getChangedNodeProps(e.props[r],o),d=i.props,s=i.values;d.length>0&&(domOpsCount++,updateProperties(d,s,document.getElementById(o.id)))}},patch=function(){if(renderNode=shouldRenderNode(prevNode,node,nR,nodeReplacedFlag,nodeRemovedFlag,currentLevel,forceUpdateStartLevel),currentLevel<=forceUpdateStartLevel&&(nodeReplacedFlag=!1,nodeRemovedFlag=!1),renderNode.should){switch(handleUntrackedHtmlNodesFlag&&childNodeIndexes[currentLevel]++,renderNode.action){case"updateNode":$_currentNode=prevNode.dom,node.dom=$_currentNode,updateProperties(renderNode.props,renderNode.values,$_currentNode),domOpsCount++;break;case"newNode":$_currentNode=createDomElement(node),node.dom=$_currentNode,$_parentNode.appendChild($_currentNode),domOpsCount++;break;case"replaceNode":$_currentNode=createDomElement(node),node.dom=$_currentNode,replaceNode($_parentNode,$_currentNode,prevNode.dom),nodeReplacedFlag=!0,forceUpdateStartLevel=currentLevel,domOpsCount++;break;case"removeNode":var e=prevNode.dom;isNotNullandIsDef(e)&&($_parentNode.removeChild(e),e=null,childNodeIndexes[currentLevel]--,nodeRemovedFlag=!0,forceUpdateStartLevel=currentLevel,domOpsCount++);break;case"recyclable":isUndefined(keyedNodeRecycleBin[prevNode.key])?keyedNodeRecycleBin[prevNode.key]=!0:childNodeIndexes[currentLevel]--;break;case"handleKeyedUpdate":var n=$_parentNode.children[getDomIndex(currentLevel)],t=prevNode.dom,r=renderNode.keyedAction;$_currentNode=t,"runBlockUpdates"===r?isNotNull(renderNode.props)&&updateBlockProperties(renderNode):"insertNew"===r?($_currentNode=createDomElement(node),node.block&&$_currentNode.appendChild(createFragment(node.block)),$_parentNode.insertBefore($_currentNode,n),domOpsCount++):"insertOld"===r?($_parentNode.insertBefore(t,n),keyedNodeRecycleBin[node.key]=!0,domOpsCount++,node.block?isNotNull(renderNode.props)&&updateBlockProperties(renderNode):renderNode.props.length>0&&updateProperties(renderNode.props,renderNode.values,$_currentNode)):isDefined(n)&&!n.isEqualNode(t)?(swapElements($_parentNode,n,t),keyedNodeRecycleBin[node.key]=!0,domOpsCount++,node.block?isNotNull(renderNode.props)&&updateBlockProperties(renderNode):renderNode.props.length>0&&updateProperties(renderNode.props,renderNode.values,$_currentNode)):"updateAttrs"===r&&renderNode.props.length>0&&(updateProperties(renderNode.props,renderNode.values,$_currentNode),domOpsCount++),node.dom=$_currentNode}handleUntrackedHtmlNodesFlag=!(!renderNode.untrackedHtmlNodes||"child"!==nR.next||"removed"===nR.actionNext)}else node.dom=prevNode.dom,$_currentNode=node.dom,"recycled"===renderNode&&childNodeIndexes[currentLevel]--},createView=function(e,n,t,r,o,i,d,s){nodeReplacedFlag=!1,nodeRemovedFlag=!1,handleUntrackedHtmlNodesFlag=!1,forceUpdateStartLevel=null,$_parentNode=void 0,$_currentNode=void 0,$_prevParentCache=void 0,node=void 0,prevNode=void 0,currentLevel=void 0,nR=void 0,nodeIsListeningToStateKey=!1,renderNode=void 0,prevLevel=0,domOpsCount=0,domOpsComplete=!1,syncedVNodes=void 0,subscribesTo=null,clearObject(keyedNodeRecycleBin),$_parentNodeStack.length=0,childNodeIndexes.length=0,virtualDom.isInitialized()&&virtualDom.requiresSync()&&(n=(syncedVNodes=syncVNodes(n.slice(0),t,o,i,s)).domNodes,t=syncedVNodes.domNodesPrev);for(var l=0,a=n.length;l<a;l++)if((domOpsComplete||virtualDom.getDomUpdatesLimit()===domOpsCount)&&(domOpsComplete=!0),domOpsComplete)node=n[l],prevNode=t[l],node.dom=prevNode.dom,$_currentNode=node.dom;else{if(node=n[l],prevNode=t[l],isUndefined(node))break;if(currentLevel=node.level||prevNode.level,nR=getNodeRelations(l,n,node,n[l-1],n[l+1],prevNode,t[l-1],t[l+1],currentLevel),updateChildNodeFauxDomIndexes(nR,currentLevel),0!==l?isDefined($_prevParentCache)&&currentLevel===prevLevel?$_parentNode=$_prevParentCache:($_parentNode=$_parentNodeStack[$_parentNodeStack.length-1],$_prevParentCache=$_parentNode):($_parentNode=e,$_parentNodeStack[0]=$_parentNode),virtualDom.isInitialized()||d){if(d&&(prevNode.dom=$_parentNode.children[getDomIndex(currentLevel)]),nodeIsListeningToStateKey=!1,subscribesTo=node.subscribesTo||prevNode.subscribesTo,isDefined(r)&&isNotNull(subscribesTo)&&!nodeIsListeningToStateKey){for(var c=0;c<subscribesTo.length;c++)if(r.indexOf(subscribesTo[c])>-1){nodeIsListeningToStateKey=!0;break}}else isNull(subscribesTo)||(nodeIsListeningToStateKey=!0);nodeIsListeningToStateKey?patch():prevNode.parentComponent===node.parentComponent&&isNotNull(node.props)&&isNotNull(prevNode.props)&&!nodeReplacedFlag&&!nodeRemovedFlag&&node.type===prevNode.type&&"insertOld"!==node.keyedAction?(node.dom=prevNode.dom,$_currentNode=node.dom):patch()}else $_currentNode=createDomElement(node),$_parentNode.appendChild($_currentNode),node.dom=$_currentNode,node.block&&$_currentNode.appendChild(createFragment(node.block));"child"===nR.next&&"removed"!==nR.action?$_parentNodeStack[$_parentNodeStack.length]=$_currentNode:"parent"===nR.next&&$_parentNodeStack.splice(nR.nextNodeLevel,currentLevel-nR.nextNodeLevel),prevLevel=currentLevel}},createString=function(e){for(var n="",t=void 0,r=void 0,o=[],i=0,d=e.length;i<d;i++){t=e[i],r=e[i+1],n+="<"+t.type;if(Object.keys(t.props).filter(function(e){return"text"!==e&&"o"!=e[0]&&"n"!=e[1]}).forEach(function(e){if("style"===e){n+=' style="';var r=Object.keys(t.props.style);r.forEach(function(e,o){n+=e+":"+t.props.style[e]+";",o!==r.length-1&&(n+=" ")}),n+='"'}else Array.isArray(t.props[e])?"data"===e?t.props.data.forEach(function(e){n+=" data-"+e}):"class"===e&&t.props.class.forEach(function(e){n+=" "+e}):n+=" "+e+'="'+t.props[e]+'"'}),voidedElements[t.type])n+="/>";else if(o.push(t.type),n+=">",t.props.text&&(n+=t.props.text),t.props.innerHTML&&(n+=t.props.innerHTML),r){if(r.level===t.level)n+="</"+o.pop()+">";else if(r.level<t.level)for(var s=t.level-r.level,l=0;l<=s;l++)n+="</"+o.pop()+">"}else for(var a=o.length,c=0;c<a;c++)n+="</"+o.pop()+">"}return n},vDomNodeBuilder=void 0,vDomNodesArrayPrevious=[],renderString=function(e,n){var t=e.runTime[n],r=e.toStringAsyncResolve[n];(vDomNodeBuilder=isDefined(vDomNodeBuilder)?vDomNodeBuilder:{})[n]=isDefined(vDomNodeBuilder[n])?vDomNodeBuilder[n]:nodeBuilder(t,e.appGlobalActions[n]);var o=vDomNodeBuilder[n];if(o.renderRootComponent({$$_appRootView:e.appView[n]},{props:t.getState()},"toString"),r&&0===o.getLazyCount())r(createString(o.getVDomNodesArray()));else{if(!r)return createString(o.getVDomNodesArray());o.resetVDomNodesArray()}},hydrateApp=function(e,n,t,r,o,i){var d=e.runTime[n];(vDomNodeBuilder=isDefined(vDomNodeBuilder)?vDomNodeBuilder:{})[n]=isDefined(vDomNodeBuilder[n])?vDomNodeBuilder[n]:nodeBuilder(d,e.appGlobalActions[n]);var s=vDomNodeBuilder[n];s.renderRootComponent({$$_appRootView:e.appView[n]},{props:d.getState()},"creatingHydrationLayer"),0!==s.getLazyCount()?s.resetVDomNodesArray():(vDomNodesArrayPrevious=s.getVDomNodesArray().slice(0),renderApp(e,n,t,r,o,i,!0))},renderApp=function(e,n,t,r,o,i,d){var s=e.runTime[n],l=e.appGlobalActions[n],a=e.appOnInit[n],c=void 0;!t||d?(c=vDomNodeBuilder[n],vDomNodesArrayPrevious=c.getVDomNodesArray().slice(0),c.resetVDomNodesArray()):((vDomNodeBuilder=isDefined(vDomNodeBuilder)?vDomNodeBuilder:{})[n]=nodeBuilder(s,l),c=vDomNodeBuilder[n],virtualDom.setInitialized(!1),virtualDom.setSync(!1)),c.setKeyedNodesPrev(),c.renderRootComponent({$$_appRootView:e.appView[n]},{props:s.getState()},"toDom");var u=c.getLocalSubs();e.runHandleLocalSubs(u,n),c.resetLocalSubs(),createView(e.appContainer[n],c.getVDomNodesArray(),vDomNodesArrayPrevious,r,c.getKeyedNodes(),c.getKeyedNodesPrev(),d,c.getBlockCache()),t||d?(isFunction(a)&&a(l),virtualDom.setInitialized(!0),virtualDom.setSync(!0)):s.exeQueuedMsgs(void 0,o,void 0,i)},globalActions=function(e,n){var t={},r=function(e){var r=Object.keys(e)[0];t[r]=e[r]({stamp:n.stamp,msgs:n.messages})};if(isDefined(e)){if(isArray(e))for(var o=0;o<e.length;o++)r(e[o]);else r(e);return t}},subscription=function(){console.log("initi SUBS");var e={};return{addEvent:function(n,t,r,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],d=arguments[5];e[r]={fun:function(e){o.apply(null,[].concat(toConsumableArray(i),[e]))},el:n,name:t,typeLocal:d},n.addEventListener(t,e[r].fun)},removeEvent:function(n,t,r){n.removeEventListener(t,e[r].fun),delete e[r]},getCache:function(){return console.log("CHCHCCCCCHC",e),e},setCache:function(n,t){e[n]=t}}}(),handleSubscriptions=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];console.log(e,n,t);for(var r=function(n){var r=e[n],o=isArray(r.action)?r.action[0]:r.action,i=subscription.getCache();console.log("CACHE ",JSON.parse(JSON.stringify(i))),console.log(r),isUndefined(o.name)&&Object.defineProperty(o.prototype,"name",{get:function(){return/function ([^(]*)/.exec(this+"")[1]}}),o=isArray(r.action)?function(){var e;return(e=r.action)[0].apply(e,toConsumableArray(r.action.slice(1)))}:r.action;var d=r.key||o.name+"_"+(r.name||"sub-key").toString().replace(/\s/g,"");if(r.key=d,r.typeLocal=t,r.name)if(isFunction(r.name))if(r.when)console.log("sub.when",r.key,i,!i[r.key]),isUndefined(i[r.key])&&(subscription.setCache(r.key,{typeLocal:t,unmount:r.name(o,r.options)}),console.log("cahced ",i),console.log("subscription.getCache() ",subscription.getCache()));else{console.log("not when");var s=i[r.key];s&&(isFunction(s.unmount)&&s.unmount(),delete i[r.key])}else isString(r.name)&&(r.when||isUndefined(r.when)?isDefined(subscription.getCache()[d])||subscription.addEvent(r.el||window,r.name,d,o,isArray(r.action)?r.action.slice(1):void 0,r.typeLocal):isDefined(subscription.getCache()[d])&&subscription.removeEvent(r.el||window,r.name,d));else i[r.key]||(i[r.key]={name:!1,when:r.when,fun:o,typeLocal:t}),r.when&&(i[r.key].unmount=i[r.key].fun())},o=0;o<e.length;o++)r(o);var i=e.map(function(e){return e.key}),d=subscription.getCache();Object.keys(d).forEach(function(e){var n=d[e];n.typeLocal&&-1===i.indexOf(e)&&(n.name?isFunction(n.name)||isString(n.name)&&subscription.removeEvent(n.el||window,n.name,e):(isFunction(n.unmount)&&n.unmount(),delete d[e]))})},karbon={runTime:{},appContainer:{},appView:{},appGlobalActions:{},appSubs:{},appOnInit:{},renderToString:{},toStringAsyncResolve:{},process:{},appCounter:0,render:function(e){this.init(e,!1,"render")},hydrate:function(e){this.init(e,!1,"hydrate")},toString:function(e){return this.init(e,!0,"string")},toStringAsync:function(e){var n=this;return new Promise(function(t){n.toStringAsyncPromise=new Promise(function(t){n.init(e,!0,"toStringAsync",t)}),n.toStringAsyncPromise.then(function(e){t(e)})})},init:function(e,n,t,r){this.appCounter++;var o=this.appCounter;if(this.renderToString[o]=n,this.toStringAsyncResolve[o]=r,this.process[o]=t,this.appContainer[o]=isBrowser()?e.container(document):null,this.appSubs[o]=e.subscriptions,this.runTime[o]=createRunTime(this,o),this.runTime[o].setState(e.state),this.appView[o]=e.view,this.appGlobalActions[o]=this.initGlobalActions(e.actions,this.runTime[o]),this.appOnInit[o]=e.init,isBrowser()&&this.runHandleSubs(o),n)return renderString(this,o);"hydrate"===this.process[o]?(this.process[o]="render",hydrateApp(this,o,!0)):(this.appContainer[o].innerHTML="",renderApp(this,o,!0))},initGlobalActions:function(e,n){return globalActions(e,n)},handleSubs:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];handleSubscriptions(e,n,t,this.appTap)},runHandleSubs:function(e){isFunction(this.appSubs[e])&&this.handleSubs(this.appSubs[e](this.runTime[e].getState(),this.appGlobalActions[e]),e)},runHandleLocalSubs:function(e,n){this.handleSubs(e,n,!0)},reRender:function(e,n,t,r,o){o?hydrateApp(this,t,!0):"render"===this.process[t]?renderApp(this,t,!1,e,n,r):this.renderToString[t]&&"toStringAsync"===this.process[t]&&renderString(this,t)}},render=void 0,hydrate=void 0,toString=void 0,toStringAsync=void 0;isBrowser()&&document.currentScript&&"noModule"in document.currentScript||!isBrowser()?(render=karbon.render.bind(karbon),hydrate=karbon.hydrate.bind(karbon),toString=karbon.toString.bind(karbon),toStringAsync=karbon.toStringAsync.bind(karbon)):(window.karbon={},window.karbon.render=karbon.render.bind(karbon),window.karbon.hydrate=karbon.hydrate.bind(karbon),window.karbon.toString=karbon.toString.bind(karbon),window.karbon.toStringAsync=karbon.toStringAsync.bind(karbon));export{render,hydrate,toString,toStringAsync};
