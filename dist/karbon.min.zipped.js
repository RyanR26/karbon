var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},toConsumableArray=function(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)},subscription=function(){var e={};return{add:function(n,t,o,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];i=i||[],e[o]=function(e){r.apply(null,[].concat(toConsumableArray(i),[e]))},n.addEventListener(t,e[o])},remove:function(n,t,o){n.removeEventListener(t,e[o]),e[o]=void 0},getCache:function(){return e}}}(),isUndefined=function(e){return void 0===e},isDefined=function(e){return void 0!==e},isNull=function(e){return null===e},isNotNull=function(e){return null!==e},isNullorUndef=function(e){return isUndefined(e)||isNull(e)},isNotNullandIsDef=function(e){return null!==e&&void 0!==e},isFalse=function(e){return!1===e},isNotFalse=function(e){return!1!==e},isEmpty=function(e){return""===e},isNotEmpty=function(e){return""!==e},isFunction=function(e){return"function"==typeof e},isObject=function(e){return"object"===(void 0===e?"undefined":_typeof(e))},isArray=Array.isArray,isNumber=function(e){return"number"==typeof e},isString=function(e){return"string"==typeof e},isPromise=function(e){return e instanceof Promise},randomStringId=function(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(2,10)},clearObject=function(e){for(var n in e)delete e[n]},arraysAreEqual=function(e,n){if(e.length!==n.length)return!1;for(var t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0},keyList=Object.keys,hasProp=Object.prototype.hasOwnProperty,objsAreEqual=function e(n,t){if(n===t)return!0;if(n&&t&&"object"==(void 0===n?"undefined":_typeof(n))&&"object"==(void 0===t?"undefined":_typeof(t))){var o=isArray(n),r=isArray(t),i=void 0,d=void 0,s=void 0;if(o&&r){if((d=n.length)!=t.length)return!1;for(i=d;0!=i--;)if(!e(n[i],t[i]))return!1;return!0}var a=keyList(n);if((d=a.length)!==keyList(t).length)return!1;for(i=d;0!=i--;)if(!hasProp.call(t,a[i]))return!1;for(i=d;0!=i--;)if(!e(n[s=a[i]],t[s]))return!1;return!0}return n!=n&&t!=t},virtualDom=function(){var e=!1,n=!0,t=!1;return{isInitialized:function(){return e},setInitialized:function(n){return e=n},requiresSync:function(){return n},setSync:function(e){return n=e},constrainDomUpdates:function(e){return t=e},getDomUpdatesLimit:function(){return t}}}(),createRunTime=function(e,n){var t,o,r,i,d,s,a=void 0,l=e.appFx[n],c=0,u={},p={},v=void 0,f=function(e){a=e},m=function(){return a},N=(t=null,o=null,r=void 0,i=void 0,d=function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];t=null,c++;var d=(r||randomStringId())+"_"+c,a=Object.assign({},i);return i=void 0,r=void 0,window.setTimeout(function(){h(d,n,a)},0),{done:s(d)}},s=function(e){return function(n){isNull(t)?p[e]=n:(delete u[e],n(t,o))}},{stamp:function(e){return r=e.id,i=e.cache,{msgs:d}},messages:d,setCallbackData:function(e,n){t=e,o=n}}),h=function(e,n,t){u[e]=[];for(var o=1;o<n.length;o++)u[e][o-1]=n[o];g(e,n[0],v,t)},y=function(e,n){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments[3];if(isDefined(n))if(u[n].length>0)g(n,u[n].shift(),e,o);else if(delete u[n],isFunction(p[n])){var r=Object.assign({},p);delete p[n],r[n](e,t)}else N.setCallbackData(e,t)},g=function(e,n,t,o){var r=isFunction(n)?isNotNullandIsDef(t)?n("undefined"===t?void 0:t,m(),o):n(m(),o):n;if(isNull(r))y(null,e,v,o);else if(isUndefined(r))y("undefined",e,v,o);else{var i=r[1],d=r[2]||{};switch(r[0]){case"state":d.fixedDomShape?virtualDom.setSync(!1):virtualDom.setSync(!0),isDefined(d.maxDomUpdates)?virtualDom.constrainDomUpdates(d.maxDomUpdates):virtualDom.constrainDomUpdates(!1),k(i,e,!!d.preventRender,o);break;case"effect":var s=i.cache,a=i.name||i.def,c=isFunction(a)?a:isDefined(l[a])?l[a]:function(){return console.warn("no effect '"+a+"' registered")},f=isArray(i.args)?c.apply(void 0,toConsumableArray(i.args)):c(i.args);isPromise(f)?Promise.resolve(f).then(function(n){isDefined(s)&&(o[s]=n),y(n,e,v,o)}).catch(function(n){isDefined(s)&&(o[s]=n),y({error:!0,errorMsg:n},e,v,o)}):"_break_"===f?u[e]=[]:(isDefined(s)&&(o[s]=f),y(f,e,v,o));break;case"pipe":var N=i,h=N[0],g=null;if(N.length<2)g=h;else for(var b=1;b<N.length;b++)g=1===b?N[b](h):N[b](g);y(g,e,v,o);break;case"control":i.if||i.continue||isNumber(i.continue)||isNumber(i.skip)?(i.if||(isNumber(i.continue)?u[e].length=i.continue:isNumber(i.skip)&&u[e].splice(0,i.skip)),y(i.if?i.isTrue:i.isFalse,e,v,o)):(u[e]=[],i.break?delete p[e]:y(i.isFalse,e,!1,o));break;case"cancel":var C=function(e){var n=!1;for(var t in u)0===t.indexOf(e)&&(n=!0,u[t]=[],delete p[t]);if(!n)for(var o in p)0===o.indexOf(e)&&delete p[o]},A=i.id;if(isDefined(A)){if(isArray(A))for(var S=0;S<A.length;S++)C(A);else C(A);y(void 0,e)}}}},b=function e(n,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"default",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(isUndefined(t))f(o);else if(2==t.length){if("default"===r)return e(n[t[0]],t.slice(1),o,r,i,d);var s=n[t[0]];if(isNullorUndef(s))throw new Error('Karbon - cannot modify undefined array "'+t[0]+'".');if("splice"===r){var a=t[1];if(i>1){var l=[a,d];if(isArray(o))for(var c=0;c<o.length;c++)l[l.length]=o[c];else for(var u=0;u<i;u++)l[l.length]=o;s.splice.apply(s,l)}else if(isNotNull(o))s.splice(a,d,o);else{if(isNullorUndef(s[a]))throw new Error('Karbon - cannot remove. Array "'+t[0]+'" does not contain item at position "'+a+'".');s.splice(a,d)}}else if("delete"===r){var p=t[1];if(isNullorUndef(s[p]))throw new Error('Karbon - cannot delete undefined obj key "'+p+"\". Check that it wasn't removed in a previous action.");delete s[p]}}else{if(1!=t.length)return 0==t.length?n:e(n[t[0]],t.slice(1),o,r,i,d);var v=t[0];if(!isArray(v))return n[v]=o;for(var m=0;m<v.length;m++)isArray(o)?n[v[m]]=o[m]:n[v[m]]=o}},k=function(t,o,r,i){var d=isArray(t)?[]:isDefined(t.path)?t.path[0]:void 0;if(isArray(t))for(var s=0;s<t.length;s++){var l=t[s];b(a,l.path,l.value,l.action,l.add,l.remove),d[s]=l.path[0]}else b(a,t.path,t.value,t.action,t.add,t.remove);e.runHandleSubs(n),r?y(void 0,o,v,i):e.reRender(d,o,n,i)};return{setState:f,getState:m,exeQueuedMsgs:y,forceReRender:function(){e.reRender(void 0,void 0,n)},stamp:N.stamp,messages:N.messages}},voidedElements={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,animate:!0,animateTransform:!0,circle:!0,"color-profile":!0,ellipse:!0,feBlend:!0,feColorMatrix:!0,feComposite:!0,feConvolveMatrix:!0,feDisplacementMap:!0,feDistantLight:!0,feFlood:!0,feGaussianBlur:!0,feImage:!0,feMergeNode:!0,feMorphology:!0,feOffset:!0,fePointLight:!0,feSpotLight:!0,feTile:!0,feTurbulence:!0,"font-face-name":!0,image:!0,line:!0,mpath:!0,path:!0,polygon:!0,polyline:!0,set:!0,stop:!0,use:!0,view:!0,rect:!0},createVNode=function(e,n,t,o){for(var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments[5],d=arguments[6],s=arguments[7],a=arguments[8],l={},c=Object.keys(t),u=0;u<c.length;u++){var p=c[u],v=t[p];l[p]=isNull(v)?"":"innerHTML"!==p?v:'<span data="untracked-nodes">'+v+"</span>"}return{type:e,lang:a?"xml":"html",props:l,level:o,key:r,staticChildren:i,keyedAction:null,keyedChildren:null,parentComponent:d,parentComponentIndex:n,subscribesTo:s,dom:null}},actionsCache={},lazyCache={},nodeBuilder=function(e,n,t){var o=[],r=[],i=[],d=[],s={},a=void 0,l=void 0,c=!1,u=void 0,p=void 0,v=void 0,f=1,m=!1;actionsCache[t]={},lazyCache[t]={};var N=function(e){f--,"svg"!==e&&"/svg"!==e||(m=!1)},h=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{key:!1,staticChildren:!1};"svg"===e&&(m=!0),l=t.key,c=!1!==l,v=createVNode(e,i[i.length-1],n,f,l,t.staticChildren,r[r.length-1],d[d.length-1],m),o[o.length]=v,isDefined(p)&&(f>u?p.keyedChildren[p.keyedChildren.length]=v:f===u&&(p=void 0,u=void 0)),c&&(u=f,p=v,v.keyedChildren=[],isUndefined(s[f])&&(s[f]={}),s[f][l]=v),voidedElements[e]||f++},y=function o(s){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};isArray(s)&&(a=s[1]||{},s=s[0]);var l=Object.keys(s)[0],c=s[l],u=isUndefined(a.index)?0:a.index;r[r.length]=l,i[i.length]=u;var p=void 0,v=a.actions;if(isDefined(v)){p={},v=isArray(v)?v:[v];for(var f=0;f<v.length;f++){var m=v[f],y=Object.keys(m)[0];isDefined(actionsCache[t][y])?p[y]=actionsCache[t][y]:(p[y]=m[y]({stamp:e.stamp,msgs:e.messages}),actionsCache[t][y]=p[y])}}d[d.length]=isUndefined(a.subscribe)||"all"===a.subscribe?Object.keys(e.getState()):a.subscribe;var b=isDefined(a.mergeStateToProps)?a.mergeStateToProps(e.getState()):void 0;c(isDefined(b)?Object.assign({},a.props,b):a.props,isDefined(p)||isDefined(n)?Object.assign({},p,n):void 0,u)(h,N,o,g),d.length=d.length-1,r.length=r.length-1,i.length=i.length-1},g=function(n,o,r,i,d){var s=n.toString().replace(/ /g,"");if("error"===lazyCache[t][s])isFunction(i)&&i();else if(isDefined(lazyCache[t][s])){var a=lazyCache[t][s][0];isFunction(a)&&a(lazyCache[t][s][1])}else{isFunction(r)&&r(),(isPromise(n)?Promise.resolve(n):n()).then(function(n){setTimeout(function(){lazyCache[t][s]=[o,n],e.forceReRender(),window.dispatchEvent(new CustomEvent("Lazy_Component_Rendered",{detail:{key:s}}))},d||0)}).catch(function(n){console.error(n),lazyCache[t][s]="error",e.forceReRender(),window.dispatchEvent(new CustomEvent("Lazy_Component_Error",{detail:{key:s}}))})}};return{renderRootComponent:function(e,n){y(e,n)},component:y,getKeyedNodes:function(){return s},getKeyedNodesPrev:function(){return a},setKeyedNodesPrev:function(){a=Object.assign({},s),clearObject(s)},getVDomNodesArray:function(){return o},resetVDomNodesArray:function(){o.length=0}}},documentCreateElement=function(e,n){return n?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e)},createDomElement=function(e){for(var n=e.props,t=Object.keys(n),o="xml"===e.lang,r=documentCreateElement(e.type,o),i=function(e,i){var d=t[e],s=n[d];if(isObject(s))if(isDefined(s.length))if("class"===d){var a,l=s.filter(Boolean);if(l.length>0)(a=r.classList).add.apply(a,toConsumableArray(l))}else if("o"===d[0]&&"n"===d[1])r[d]=function(e){return s[0].apply(null,[].concat(toConsumableArray(s.slice(1)),[e]))};else for(var c=0;c<s.length;c++){var u=s[c].split("=");r.setAttribute("data-"+u[0],u[1]||"")}else for(var p=Object.keys(s),v=0;v<p.length;v++){var f=p[v];r[d][f]=s[f]}else"text"===d?r.textContent=s:"class"===d?isNotEmpty(s)&&(r.className=s):isDefined(r[d])&&!o?r[d]=s:r.setAttribute(d,s)},d=0,s=t.length;d<s;d++)i(d);return r},statefulElements={radio:!0},renderObj={should:null,action:null,keyedAction:null,untrackedHtmlNodes:null,props:null,values:null},updateRenderObj=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];renderObj.should=e,renderObj.action=n,renderObj.keyedAction=t,renderObj.untrackedHtmlNodes=i,renderObj.props=o,renderObj.values=r},shouldRenderNode=function(e,n,t,o,r,i,d){var s=e.props,a=n.props,l=[],c=[],u=!0,p=!1,v=!1,f=!1;if(u=!(n.type!==e.type||isNull(s)||isNull(a)||isNotNull(n.keyedAction))&&objsAreEqual(s,a),(o||r)&&i>d)return"removed"!==t.action&&(updateRenderObj(!0,"newNode"),renderObj);if(u)return!1;if(isNotNull(s)&&isNotNull(a)){if(isDefined(a.innerHTML)&&(p=!0),statefulElements[s.type]&&s.type===a.type&&(f=!0),!1===n.key&&!1===e.key||!isNotNull(n.keyedAction)||(v=!0),(n.type!==e.type||p||f)&&!v)return updateRenderObj(!0,"replaceNode",void 0,void 0,void 0,p),renderObj;for(var m=Object.keys(a),N=Object.keys(s),h=void 0,y=void 0,g=0;g<m.length;g++)y=a[h=m[g]],isDefined(s[h])?isArray(y)?arraysAreEqual(y,s[h])||(l[l.length]=h,c[c.length]=y):isObject(y)?objsAreEqual(y,s[h])||(l[l.length]=h,c[c.length]=y):y!==s[h]&&(l[l.length]=h,c[c.length]=y):(l[l.length]=h,c[c.length]=y);for(var b=0;b<N.length;b++){var k=N[b];-1===m.indexOf(k)&&("innerHTML"!==k?(l[l.length]=k,c[c.length]="class"===k||"dataAttrs"===k?[]:""):(l.unshift(k),c.unshift("")))}return v?(updateRenderObj(!0,"handleKeyedUpdate",n.keyedAction,l,c),renderObj):(updateRenderObj(!0,"updateNode",void 0,l,c),renderObj)}return isNull(s)&&isNotNull(a)?(isDefined(a.innerHTML)&&(p=!0),"insertNew"===n.keyedAction?updateRenderObj(!0,"handleKeyedUpdate",n.keyedAction,void 0,void 0,p):updateRenderObj(!0,"newNode",e.keyedAction,void 0,void 0,p),renderObj):!(!isNotNull(s)||!isNull(a))&&("recycled"===n.keyedAction?n.keyedAction:"recyclable"===n.keyedAction?(updateRenderObj(!0,n.keyedAction),renderObj):(updateRenderObj(!0,"removeNode"),renderObj))},updateChangedNode=function(e,n,t){switch(e){case"class":if(t.removeAttribute(e),isString(n)&&isNotEmpty(n))t.className=n;else if(isArray(n)&&n.length>0){var o;(o=t.classList).add.apply(o,toConsumableArray(n.filter(Boolean)))}break;case"style":for(var r=Object.keys(n),i="",d=0;d<r.length;d++){var s=r[d];isDefined(n[s])&&(i+=s+":"+n[s]+"; ")}isNotEmpty(i)?t.style.cssText=i:t.removeAttribute(e);break;case"text":if(t.hasChildNodes()){var a=t.firstChild;isDefined(a.data)?a.data=n:t.insertBefore(document.createTextNode(n),a)}else t.textContent=n;break;case"dataAttrs":for(var l=0;l<t.attributes.length;l++)/^data-/i.test(t.attributes[l].name)&&(t.removeAttribute(t.attributes[l].name),l--);for(var c=0;c<n.length;c++){var u=n[c].split("=");t.setAttribute("data-"+u[0],u[1]||"")}break;default:"o"===e[0]&&"n"===e[1]?isString(n)?t[e]=null:t[e]=function(e){return n[0].apply(null,[].concat(toConsumableArray(n.slice(1)),[e]))}:isUndefined(t[e])||t instanceof SVGElement?t.setAttribute(e,n):isEmpty(n)?(t[e]=!1,t.removeAttribute(e)):t[e]=n}},emptyVNodeStatic={type:null,lang:null,props:null,level:void 0,key:!1,keyedAction:null,keyedChildren:null,staticChildren:!1,parentComponent:null,parentComponentIndex:null,subscribesTo:null,dom:null},recycledVNodeStatic=Object.assign({},emptyVNodeStatic,{keyedAction:"recycled"}),recyclableVNodeStatic=Object.assign({},emptyVNodeStatic,{keyedAction:"recyclable"}),syncVNodes=function(e,n,t,o){var r=void 0,i=void 0,d=!1;if(0===e.length)for(var s=0;s<n.length;s++)e[s]=emptyVNodeStatic;else for(var a=function(s){if(r=n[s],i=e[s],d=!1,isUndefined(r)?n[s]=emptyVNodeStatic:isUndefined(i)?e[s]=emptyVNodeStatic:r.level>i.level?e.splice(s,0,emptyVNodeStatic):r.level<i.level&&n.splice(s,0,emptyVNodeStatic),s===e.length-1){var a=n.length-e.length;if(a>0)for(var l=1;l<=a;l++)e[e.length]=emptyVNodeStatic,d=!0}r=n[s],i=e[s];var c=o[i.level||r.level];if(isDefined(c)){var u=void 0,p=void 0,v=void 0;if(isNotFalse(i.key)&&r.key!==i.key){u=isDefined(c[r.key]),p=!isUndefined(t[i.level])&&isDefined(t[i.level][r.key]),i.level<=v&&(v=void 0),v=isDefined(v)?v:i.level;var f=c[i.key];if(isDefined(f)){var m=function(){if(f.keyedChildren.length>0){for(var e=0;isDefined(n[s+e+1])&&n[s+e+1].level>v;)e++;n.splice.apply(n,[s+1,e].concat(toConsumableArray(f.keyedChildren)))}};isNull(r.props)||isNotFalse(r.key)&&!u?(n[s]=f,i.keyedAction="insertOld",m()):isFalse(r.key)||!p?(e.splice(s,0,emptyVNodeStatic),i=e[s]):(n[s]=f,i.keyedAction="swap",m()),delete c[i.key]}else isNull(r.props)?n[s]=emptyVNodeStatic:n.splice(s,0,emptyVNodeStatic),i.keyedAction="insertNew"}else if(isNotFalse(i.key)&&r.key===i.key)i.keyedAction="updateAttrs";else if(isNotFalse(r.key)&&r.key!==i.key){u=isDefined(c[r.key]),p=!isUndefined(t[r.level])&&isDefined(t[r.level][r.key]);var N=function(){if(r.keyedChildren.length>0){for(var e=0;isDefined(n[s+e+1])&&n[s+e+1].level>r.level;)e++;n.splice(s+1,e)}};isNotNull(i.props)?u&&p?(n.splice(s,0,emptyVNodeStatic),i.keyedAction="insertNew",N()):!u&&p?(e.splice(s,0,recycledVNodeStatic),N()):p||(r.key=!1):p?(e[s]=recyclableVNodeStatic,N()):r.key=!1}}if(d&&e.length===n.length)return"break"},l=0;l<e.length;l++){if("break"===a(l))break}return{domNodes:e,domNodesPrev:n}},getNodeRelations=function(e,n,t,o,r,i,d,s,a,l){var c=void 0,u="child",p=void 0,v=null,f=null,m=null,N=isUndefined(o)?-1:isNotNull(o.props)?o.level:d.level,h=isUndefined(r)?void 0:isNotNull(r.props)?r.level:s.level;return e>0&&(N<a?(c="parent",u="child"):N>a?(c="child",u="parent"):(c="child",u="sibling"),isDefined(d)&&isNull(o.props)&&isNotNull(d.props)&&(m="removed")),e<n.length-l-1&&(p=h<a?"parent":h>a?"child":"sibling",isNull(r.props)?f="removed":isDefined(s)&&isNull(s.props)&&(f="add")),isNull(t.props)?v="removed":isDefined(i)&&isNull(i.props)&&(v="add"),{previous:c,current:u,next:p,action:v,actionNext:f,actionPrev:m,nextNodeLevel:h}},nodeReplacedFlag=void 0,nodeRemovedFlag=void 0,handleUntrackedHtmlNodesFlag=void 0,forceUpdateStartLevel=void 0,keyedNodeRecycleBin={},$_parentNodeStack=[],$_parentNode=void 0,$_currentNode=void 0,$_prevParentCache=void 0,node=void 0,prevNode=void 0,currentLevel=void 0,nR=void 0,nodeIsListeningToStateKey=void 0,renderNode=void 0,prevLevel=void 0,nodesToSkip=void 0,domOpsCount=void 0,domOpsComplete=void 0,syncedVNodes=void 0,subscribesTo=void 0,childNodeIndexes=[],getDomIndex=function(e){return childNodeIndexes[e]},updateChildNodeFauxDomIndexes=function(e,n){switch(e.current){case"parent":childNodeIndexes[n]++;break;case"child":childNodeIndexes[n]=0;break;case"sibling":childNodeIndexes[n]++}},replaceNode=function(e,n,t){isDefined(t)&&isNotNull(t)?e.replaceChild(n,t):e.appendChild(n)},swapElements=function(e,n,t){var o=t.nextSibling;o===n?e.insertBefore(n,t):e.insertBefore(t,n),isDefined(n)&&e.insertBefore(n,o)},updateProperties=function(e,n,t){for(var o=0;o<e.length;o++)updateChangedNode(e[o],n[o],t)},patch=function(){if(renderNode=shouldRenderNode(prevNode,node,nR,nodeReplacedFlag,nodeRemovedFlag,currentLevel,forceUpdateStartLevel),currentLevel<=forceUpdateStartLevel&&(nodeReplacedFlag=!1,nodeRemovedFlag=!1),renderNode.should){switch(handleUntrackedHtmlNodesFlag&&childNodeIndexes[currentLevel]++,renderNode.action){case"updateNode":$_currentNode=prevNode.dom,node.dom=$_currentNode,updateProperties(renderNode.props,renderNode.values,$_currentNode),domOpsCount++;break;case"newNode":$_currentNode=createDomElement(node),node.dom=$_currentNode,$_parentNode.appendChild($_currentNode),domOpsCount++;break;case"replaceNode":$_currentNode=createDomElement(node),node.dom=$_currentNode,replaceNode($_parentNode,$_currentNode,prevNode.dom),nodeReplacedFlag=!0,forceUpdateStartLevel=currentLevel,domOpsCount++;break;case"removeNode":var e=prevNode.dom;isNotNullandIsDef(e)&&($_parentNode.removeChild(e),e=null,childNodeIndexes[currentLevel]--,nodeRemovedFlag=!0,forceUpdateStartLevel=currentLevel,domOpsCount++);break;case"recyclable":isUndefined(keyedNodeRecycleBin[prevNode.key])?keyedNodeRecycleBin[prevNode.key]=!0:childNodeIndexes[currentLevel]--;break;case"handleKeyedUpdate":var n=$_parentNode.children[getDomIndex(currentLevel)],t=prevNode.dom,o=renderNode.keyedAction;$_currentNode=t,"insertNew"===o?($_currentNode=createDomElement(node),$_parentNode.insertBefore($_currentNode,n),domOpsCount++):"insertOld"===o?($_parentNode.insertBefore(t,n),keyedNodeRecycleBin[node.key]=!0,domOpsCount++,renderNode.props.length>0&&updateProperties(renderNode.props,renderNode.values,$_currentNode)):"swap"===o||isDefined(n)&&!n.isEqualNode(t)?(swapElements($_parentNode,n,t),keyedNodeRecycleBin[node.key]=!0,domOpsCount++,renderNode.props.length>0&&updateProperties(renderNode.props,renderNode.values,$_currentNode)):"updateAttrs"===o&&renderNode.props.length>0&&(updateProperties(renderNode.props,renderNode.values,$_currentNode),domOpsCount++),node.dom=$_currentNode}handleUntrackedHtmlNodesFlag=!(!renderNode.untrackedHtmlNodes||"child"!==nR.next||"removed"===nR.actionNext)}else node.dom=prevNode.dom,$_currentNode=node.dom,"recycled"===renderNode&&childNodeIndexes[currentLevel]--},createView=function(e,n,t,o,r,i){nodeReplacedFlag=!1,nodeRemovedFlag=!1,handleUntrackedHtmlNodesFlag=!1,forceUpdateStartLevel=null,$_parentNode=void 0,$_currentNode=void 0,$_prevParentCache=void 0,node=void 0,prevNode=void 0,currentLevel=void 0,nR=void 0,nodeIsListeningToStateKey=!1,renderNode=void 0,prevLevel=0,nodesToSkip=0,domOpsCount=0,domOpsComplete=!1,syncedVNodes=void 0,subscribesTo=null,clearObject(keyedNodeRecycleBin),$_parentNodeStack.length=0,childNodeIndexes.length=0,virtualDom.isInitialized()&&virtualDom.requiresSync()&&(n=(syncedVNodes=syncVNodes(n.slice(0),t,r,i)).domNodes,t=syncedVNodes.domNodesPrev);for(var d=0,s=n.length;d<s;d++)if((domOpsComplete||virtualDom.getDomUpdatesLimit()===domOpsCount)&&(domOpsComplete=!0),domOpsComplete)node=n[d],prevNode=t[d],node.dom=prevNode.dom,$_currentNode=node.dom;else{if(nodesToSkip>0&&(d+=nodesToSkip,nodesToSkip=0),node=n[d],prevNode=t[d],isUndefined(node))break;if(virtualDom.isInitialized()&&node.staticChildren&&"insertNew"!==node.keyedAction&&isNotNull(node.keyedAction)&&isDefined(prevNode)&&isNotNull(prevNode.props)&&(nodesToSkip=node.keyedChildren.length),currentLevel=node.level||prevNode.level,nR=getNodeRelations(d,n,node,n[d-1],n[d+nodesToSkip+1],prevNode,t[d-1],t[d+nodesToSkip+1],currentLevel,nodesToSkip),updateChildNodeFauxDomIndexes(nR,currentLevel),0!==d?isDefined($_prevParentCache)&&currentLevel===prevLevel?$_parentNode=$_prevParentCache:($_parentNode=$_parentNodeStack[$_parentNodeStack.length-1],$_prevParentCache=$_parentNode):($_parentNode=e,$_parentNodeStack[0]=$_parentNode),virtualDom.isInitialized()){if(nodeIsListeningToStateKey=!1,subscribesTo=node.subscribesTo||prevNode.subscribesTo,isDefined(o)&&isNotNull(subscribesTo)&&!nodeIsListeningToStateKey){for(var a=0;a<subscribesTo.length;a++)if(o.indexOf(subscribesTo[a])>-1){nodeIsListeningToStateKey=!0;break}}else isNull(subscribesTo)||(nodeIsListeningToStateKey=!0);nodeIsListeningToStateKey?patch():prevNode.parentComponent===node.parentComponent&&isNotNull(node.props)&&isNotNull(prevNode.props)&&!nodeReplacedFlag&&!nodeRemovedFlag&&node.type===prevNode.type&&"insertOld"!==node.keyedAction?(node.dom=prevNode.dom,$_currentNode=node.dom):patch()}else $_currentNode=createDomElement(node),$_parentNode.appendChild($_currentNode),node.dom=$_currentNode;"child"===nR.next&&"removed"!==nR.action?$_parentNodeStack[$_parentNodeStack.length]=$_currentNode:"parent"===nR.next&&$_parentNodeStack.splice(nR.nextNodeLevel,currentLevel-nR.nextNodeLevel),prevLevel=currentLevel}},vdomNodeBuilder=void 0,vDomNodesArrayPrevious=[],renderApp=function(e,n,t,o,r,i,d,s,a,l,c){var u=void 0;s?((vdomNodeBuilder=isDefined(vdomNodeBuilder)?vdomNodeBuilder:{})[l]=nodeBuilder(t,o,l),u=vdomNodeBuilder[l]):(u=vdomNodeBuilder[l],vDomNodesArrayPrevious=u.getVDomNodesArray().slice(0),u.resetVDomNodesArray()),u.setKeyedNodesPrev(),u.renderRootComponent({$$_appRootView:n},{props:t.getState()}),createView(e,u.getVDomNodesArray(),vDomNodesArrayPrevious,i,u.getKeyedNodes(),u.getKeyedNodesPrev()),s?(isFunction(r)&&r(o),a&&(virtualDom.setInitialized(!0),virtualDom.setSync(!0))):t.exeQueuedMsgs(void 0,d,void 0,c)},karbon={run:function(){this.runTime={},this.appRootComponent={},this.appRootActions={},this.appContainer={},this.appView={},this.appGlobalActions={},this.appRootSubscribe={},this.appSubs={},this.appFx={},this.appOnInit={};for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];for(var o=0;o<n.length;o++){var r=n[o],i=o,d=o===n.length-1;r.container.innerHTML="",this.appContainer[i]=r.container,this.appFx[i]=r.effects,this.appSubs[i]=r.subscriptions,this.runTime[i]=createRunTime(this,i),this.runTime[i].setState(r.state),this.appView[i]=r.view,this.appGlobalActions[i]=this.initGlobalActions(r.actions,this.runTime[i]),this.appOnInit[i]=r.init,this.runHandleSubs(i),renderApp(this.appContainer[i],this.appView[i],this.runTime[i],this.appGlobalActions[i],this.appOnInit[i],void 0,void 0,!0,d,i)}},initGlobalActions:function(e,n){var t={},o=function(e){var o=Object.keys(e)[0];t[o]=e[o]({stamp:n.stamp,msgs:n.messages})};if(isDefined(e)){if(isArray(e))for(var r=0;r<e.length;r++)o(e[r]);else o(e);return t}},handleSubs:function(e,n){for(var t=0;t<e.length;t++){var o=e[t],r=isArray(o.action)?o.action[0]:o.action;isUndefined(r.name)&&Object.defineProperty(r.prototype,"name",{get:function(){return/function ([^(]*)/.exec(this+"")[1]}});var i=o.id||r.name+"_"+o.name.toString().replace(/\s/g,"");if(isFunction(o.name))o.name({opts:o.options,action:r,actionArgs:isArray(o.action)?o.action.slice(1):[],condition:!!isNullorUndef(o.when)||o.when,subId:i,subCache:subscription.getCache()});else if(isString(o.name)){var d;o.when||isUndefined(o.when)?isDefined(o.name)?isDefined(subscription.getCache()[i])||subscription.add(o.el||window,o.name,i,r,isArray(o.action)?o.action.slice(1):void 0):isArray(o.action)?(d=o.action)[0].apply(d,toConsumableArray(o.action.slice(1))):o.action():o.when||isDefined(o.name)&&isDefined(subscription.getCache()[i])&&subscription.remove(o.el||window,o.name,i)}}},runHandleSubs:function(e){isFunction(this.appSubs[e])&&this.handleSubs(this.appSubs[e](this.runTime[e].getState(),this.appGlobalActions[e]),e)},reRender:function(e,n,t,o){renderApp(this.appContainer[t],this.appView[t],this.runTime[t],this.appGlobalActions[t],void 0,e,n,!1,void 0,t,o)}},run=void 0;document.currentScript&&"noModule"in document.currentScript?run=karbon.run.bind(karbon):(window.karbon={},window.karbon.run=karbon.run.bind(karbon));export{run};
